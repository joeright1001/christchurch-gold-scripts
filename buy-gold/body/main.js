document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{console.log("Checkbox styling disabled - filter manager handles styling")},100)}),function(){"use strict";const t={elementId:"custom-filter",defaultText:"Sort...",defaultValue:"default",retryDelay:300,options:[{text:"Default (Popular)",value:"default"},{text:"Easy Starter Options",value:"getting-started-select"},{text:"Investment Options",value:"investor-select"},{text:"All Gold",value:"all-gold-select"},{text:"All Silver",value:"all-silver-select"},{text:"In-Stock",value:"in-stock-select"},{text:"Latest / 2025",value:"latest"},{text:"Price: Best per Oz",value:"value"},{text:"Price: Low to High",value:"lowest-price"},{text:"Weight: Low to High",value:"lowest-weight"},{text:"Weight: High to Low",value:"highest-weight"}]},e={default:{type:"sort",operation:"default"},"getting-started-select":{type:"filter",operation:"checkbox_starter"},"popular-select":{type:"filter",operation:"checkbox_popular"},"investor-select":{type:"filter",operation:"checkbox_investor"},"all-gold-select":{type:"filter",operation:"checkbox_gold"},"all-silver-select":{type:"filter",operation:"checkbox_silver"},"in-stock-select":{type:"filter",operation:"checkbox_in_stock"},latest:{type:"sort",operation:"latest"},value:{type:"sort",operation:"value"},"lowest-price":{type:"sort",operation:"lowest-price"},"lowest-weight":{type:"sort",operation:"lowest-weight"},"highest-weight":{type:"sort",operation:"highest-weight"}};class i{constructor(t){this.config=t,this.element=null,this.selectedElement=null,this.optionsElement=null,this.selectedText=null,this.caret=null,this.isOpen=!1,this.init()}init(){if(this.element=document.getElementById(this.config.elementId),!this.element)return console.log(`Waiting for '${this.config.elementId}' element to be available...`),void setTimeout(()=>this.init(),this.config.retryDelay);this.buildDropdown(),this.bindEvents(),console.log("Custom dropdown initialized successfully")}buildDropdown(){this.element.innerHTML="",this.element.className="custom-dropdown",this.selectedElement=this.createElement("div","filter-selected"),this.selectedText=this.createElement("span","selected-text",this.config.defaultText),this.caret=this.createElement("span","dropdown-caret"),this.selectedElement.appendChild(this.selectedText),this.selectedElement.appendChild(this.caret),this.optionsElement=this.createElement("div","filter-options"),this.buildOptions(),this.element.appendChild(this.selectedElement),this.element.appendChild(this.optionsElement),this.element.setAttribute("data-selected",this.config.defaultValue)}createElement(t,e,i=""){const s=document.createElement(t);return s.className=e,i&&(s.textContent=i),s}buildOptions(){this.config.options.forEach(t=>{const e=this.createElement("div","filter-option",t.text);e.setAttribute("data-value",t.value),this.optionsElement.appendChild(e)})}bindEvents(){this.selectedElement.addEventListener("click",t=>this.toggleDropdown(t)),this.optionsElement.addEventListener("click",t=>this.handleOptionClick(t)),document.addEventListener("click",t=>this.handleOutsideClick(t)),this.element.addEventListener("keydown",t=>this.handleKeyboard(t))}toggleDropdown(t){t.stopPropagation(),this.isOpen=!this.isOpen,this.element.classList.toggle("active",this.isOpen),this.optionsElement.style.display=this.isOpen?"block":"none"}closeDropdown(){this.isOpen=!1,this.element.classList.remove("active"),this.optionsElement.style.display="none"}handleOptionClick(t){if(!t.target.classList.contains("filter-option"))return;const e=t.target.getAttribute("data-value"),i=t.target.textContent;this.selectOption(e,i)}selectOption(t,e){this.selectedText.textContent=e,this.selectedElement.setAttribute("data-value",t),this.element.setAttribute("data-selected",t),this.closeDropdown(),this.dispatchOperationEvent(t,e),console.log(`Dropdown selection: ${t} (${e})`)}dispatchOperationEvent(t,i){const s=e[t];if(!s)return void console.warn(`No operation mapping found for: ${t}`);const r="filter"===s.type?"filterOperation":"sortOperation",o=window.innerWidth<=1023,n=new CustomEvent(r,{detail:{operation:s.operation,originalValue:t,text:i,resetFirst:o},bubbles:!0});this.element.dispatchEvent(n),console.log(`Dispatched ${r} for: ${s.operation}`)}handleOutsideClick(t){!this.element.contains(t.target)&&this.isOpen&&this.closeDropdown()}handleKeyboard(t){if(this.isOpen&&"Escape"===t.key)this.closeDropdown()}reset(){this.selectOption(this.config.defaultValue,this.config.defaultText)}}function s(){window.customDropdown=new i(t)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s()}(),document.addEventListener("DOMContentLoaded",function(){"use strict";new class{constructor(t){this.config=t,this.buttons={},this.filterStates={},this.productElements=[],this.gridContainer=null,this.originalOrder=[],this.needsOrderRestoration=!1,this.scrollTriggerFilters=["checkbox_coin","checkbox_minted_bar","checkbox_cast_bar","checkbox_1g","checkbox_2_5g","checkbox_5g","checkbox_10g","checkbox_20g","checkbox_25g","checkbox_1_20oz","checkbox_1_10oz","checkbox_1_4oz","checkbox_1_2oz","checkbox_1oz","checkbox_2oz","checkbox_5oz","checkbox_10oz","checkbox_1kg","checkbox_asahi","checkbox_austrian","checkbox_gsm","checkbox_investment","checkbox_nzmint","checkbox_pamp","checkbox_canada","checkbox_african","checkbox_highland","checkbox_perth","checkbox_royal","checkbox_usa","checkbox_valcambi"],this.specialDivs={speakToDealer:null,personalDealerEndBlock:null,gettingStartedBlock:null},this.originalDivStates={},this.init()}init(){this.cacheElements(),this.initializeStates(),this.bindDesktopEvents(),this.bindMobileEvents(),this.cacheProducts(),this.setupGlobalNamespace(),console.log("ðŸš€ PERFORMANCE OPTIMIZED Filter Manager initialized")}cacheElements(){Object.entries(this.config.buttons).forEach(([t,e])=>{this.buttons[t]=document.getElementById(e)}),this.clearButton=document.getElementById(this.config.clearButton),this.clearButtonMobile=document.getElementById("clear-filter-mobile"),this.makeItEasyButton=document.getElementById("make-it-easy"),this.specialDivs.speakToDealer=document.getElementById("speak-to-dealer"),this.specialDivs.personalDealerEndBlock=document.getElementById("personal-dealer-end-block"),this.specialDivs.gettingStartedBlock=document.getElementById("getting-started-block"),Object.entries(this.specialDivs).forEach(([t,e])=>{e&&(this.originalDivStates[t]=window.getComputedStyle(e).display)})}initializeStates(){Object.keys(this.config.rules).forEach(t=>{this.filterStates[t]=!1})}cacheProducts(){this.productElements=Array.from(document.querySelectorAll(".product-data")),this.gridContainer=document.querySelector(".w-dyn-items.w-row"),this.captureOriginalOrder(),console.log(`ðŸš€ PERFORMANCE: Cached ${this.productElements.length} product elements`)}bindDesktopEvents(){Object.entries(this.buttons).forEach(([t,e])=>{e&&this.config.rules[t]&&(e.style.cursor="pointer",e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.toggleFilter(t)}))}),this.clearButton&&(this.clearButton.style.cursor="pointer",this.clearButton.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.clearAllFilters()})),this.clearButtonMobile&&(this.clearButtonMobile.style.cursor="pointer",this.clearButtonMobile.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.clearAllFilters()})),this.makeItEasyButton&&(this.makeItEasyButton.style.cursor="pointer",this.makeItEasyButton.addEventListener("click",t=>{if(t.preventDefault(),t.stopPropagation(),this.toggleFilter("checkbox_starter"),window.innerWidth<=991){const t=document.getElementById("getting-started-block");if(t){const e=t.offsetTop-96;window.scrollTo({top:e,behavior:"smooth"}),console.log("ðŸš€ MOBILE/TABLET: Scrolled to getting-started-block with navbar offset")}}}))}bindMobileEvents(){const t=document.getElementById("custom-filter");t?t.addEventListener("filterOperation",t=>{const{operation:e,resetFirst:i}=t.detail;i&&this.resetFiltersOnly(),this.config.rules[e]&&this.applyFilter(e,!0)}):setTimeout(()=>this.bindMobileEvents(),300)}toggleFilter(t){const e=!this.filterStates[t],i=Object.keys(this.config.exclusiveGroups).find(e=>this.config.exclusiveGroups[e].includes(t));e&&i&&this.config.exclusiveGroups[i].forEach(e=>{e!==t&&this.filterStates[e]&&(this.filterStates[e]=!1,this.updateButtonStyles(e,!1))}),this.applyFilter(t,e),i&&this.updateGroupStyles(i,e?t:null)}applyFilter(t,e){this.filterStates[t]=e,this.updateButtonStyles(t,e),e&&this.scrollTriggerFilters.includes(t)&&this.scrollToPriceTicker(),(t.includes("checkbox_starter")||t.includes("checkbox_popular")||t.includes("checkbox_in_stock"))&&(!this._lastFilterChangeTime||Date.now()-this._lastFilterChangeTime>500)&&(console.log(`ðŸš€ FILTER: ${t.replace("checkbox_","")} ${e?"ON":"OFF"}`),this._lastFilterChangeTime=Date.now()),this.applyAllFiltersOptimized()}scrollToPriceTicker(){const t=document.getElementById("price-ticker");if(!t)return;const e=t.getBoundingClientRect().top+window.pageYOffset,i=window.pageYOffset,s=e-i;let r=null;const o=t=>{null===r&&(r=t);const e=t-r,n=(a=e,l=i,c=s,(a/=800/2)<1?c/2*a*a+l:-c/2*(--a*(a-2)-1)+l);var a,l,c;window.scrollTo(0,n),e<800&&requestAnimationFrame(o)};requestAnimationFrame(o),console.log("ðŸš€ SCROLL: Initiated custom smooth scroll to price-ticker")}applyAllFiltersOptimized(){if(!this.gridContainer)return;let t=0;const e=new Set,i=Object.entries(this.filterStates).filter(([t,e])=>e),s=window.searchManager&&window.searchManager.isActive&&window.searchManager.isActive();if(0===i.length&&!s)return this.showAllItemsCSS(),this.restoreOriginalOrder(),void this.manageDivVisibility();if(!(this.filterStates.checkbox_popular||this.filterStates.checkbox_starter)&&this.needsOrderRestoration&&(this.restoreOriginalOrder(),this.needsOrderRestoration=!1),s){const t=window.searchManager.getCurrentTerm();if(t)return setTimeout(()=>{if(window.searchManager.filterProductsWithCSS){const e=window.searchManager.filterProductsWithCSS(t);console.log(`ðŸš€ COORDINATION: Search + Filter working together - ${e} products visible`)}},10),void this.manageDivVisibility()}this.productElements.forEach(i=>{const s=i.getAttribute("data-slug");if(e.has(s))return;const r=i.closest(".w-dyn-item");if(!r)return;const o=this.shouldShowAnyDataElementForSlug(s);r.classList.toggle("filter-hidden",!o),o&&t++,e.add(s)}),this.filterStates.checkbox_popular&&(this.applyPopularSortCSS(),this.needsOrderRestoration=!0),this.filterStates.checkbox_starter&&(this.applyStarterSortCSS(),this.needsOrderRestoration=!0),this.manageDivVisibility(),(!this._lastFilterLogTime||Date.now()-this._lastFilterLogTime>1e3)&&(console.log(`ðŸš€ PERFORMANCE: Filter-only processing - ${t} products visible`),this._lastFilterLogTime=Date.now())}showAllItemsCSS(){this.productElements.forEach(t=>{const e=t.closest(".w-dyn-item");e&&e.classList.remove("filter-hidden")})}applyPopularSortCSS(){if(!this.filterStates.checkbox_popular||!this.gridContainer)return;const t=Array.from(this.gridContainer.querySelectorAll(".w-dyn-item:not(.filter-hidden)")),e=[];t.forEach(t=>{const i=t.querySelector(".product-data");if(!i)return;const s=i.getAttribute("data-popular");s&&!isNaN(parseInt(s))&&e.push({element:t,value:parseInt(s)})}),e.sort((t,e)=>t.value-e.value);const i=document.createDocumentFragment();e.forEach(t=>{i.appendChild(t.element)}),this.gridContainer.appendChild(i),(!this._lastPopularSortTime||Date.now()-this._lastPopularSortTime>2e3)&&(console.log(`ðŸš€ SORT: ${e.length} items by popularity`),this._lastPopularSortTime=Date.now())}applyStarterSortCSS(){if(!this.filterStates.checkbox_starter||!this.gridContainer)return;const t=Array.from(this.gridContainer.querySelectorAll(".w-dyn-item:not(.filter-hidden)")),e=[];t.forEach(t=>{const i=t.querySelector(".product-data");if(!i)return;const s=i.getAttribute("data-getting-started");s&&!isNaN(parseInt(s))&&e.push({element:t,value:parseInt(s)})}),e.sort((t,e)=>t.value-e.value);const i=document.createDocumentFragment();e.forEach(t=>{i.appendChild(t.element)}),this.gridContainer.appendChild(i),(!this._lastStarterSortTime||Date.now()-this._lastStarterSortTime>2e3)&&(console.log(`ðŸš€ SORT: ${e.length} items by starter order`),this._lastStarterSortTime=Date.now())}manageDivVisibility(){this.filterStates.checkbox_dealer?(this.specialDivs.speakToDealer&&(this.specialDivs.speakToDealer.style.display="block"),this.specialDivs.personalDealerEndBlock&&(this.specialDivs.personalDealerEndBlock.style.display="none"),this.specialDivs.gettingStartedBlock&&(this.specialDivs.gettingStartedBlock.style.display="none")):(this.specialDivs.speakToDealer&&this.originalDivStates.speakToDealer&&(this.specialDivs.speakToDealer.style.display=this.originalDivStates.speakToDealer),this.specialDivs.personalDealerEndBlock&&this.originalDivStates.personalDealerEndBlock&&(this.specialDivs.personalDealerEndBlock.style.display=this.originalDivStates.personalDealerEndBlock),this.filterStates.checkbox_starter?this.specialDivs.gettingStartedBlock&&(this.specialDivs.gettingStartedBlock.style.display="block"):this.specialDivs.gettingStartedBlock&&(this.specialDivs.gettingStartedBlock.style.display="none"))}shouldShowAnyDataElementForSlug(t){return this.productElements.filter(e=>e.getAttribute("data-slug")===t).some(t=>this.shouldShowProduct(t))}shouldShowProduct(t){const e=Object.entries(this.filterStates).filter(([t,e])=>e);if(0===e.length)return!0;if(this.filterStates.checkbox_dealer)return!1;for(const[i,s]of e){if(!s)continue;if("checkbox_popular"===i){const e=t.getAttribute("data-popular");if(!e||isNaN(parseInt(e)))return!1;continue}if("checkbox_starter"===i){const e=t.getAttribute("data-getting-started");if(!e||isNaN(parseInt(e)))return!1;continue}if("checkbox_in_stock"===i){if("in-stock"!==t.getAttribute("data-stock-status"))return!1;continue}if("checkbox_live_mint"===i){if("live-at-the-mint"!==t.getAttribute("data-stock-status"))return!1;continue}const e=this.config.rules[i];if(!e)continue;const r=t.getAttribute(e.attribute);if(!r)return!1;if(!e.values.includes(r))return!1}return!0}updateButtonStyles(t,e){this.updateCheckboxStyles(t,e),"checkbox_starter"===t&&this.makeItEasyButton&&this.updateMakeItEasyButton(e)}updateCheckboxStyles(t,e){const i=this.buttons[t];if(!i)return;const s=i.querySelector(".custom-checkmark");if(s&&s.remove(),e){const t=document.createElement("div");t.className="custom-checkmark",t.innerHTML='\n          <svg width="20" height="20" viewBox="0 0 24 24" style="position: absolute; top: -5px; left: -2px; pointer-events: none;">\n            <polyline fill="none" points="3.7 14.3 9.6 19 20.3 5" stroke="#666" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>\n          </svg>\n        ',t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.pointerEvents="none",i.style.position="relative",i.appendChild(t)}i.style.backgroundColor=""}updateMakeItEasyButton(t){this.makeItEasyButton&&(t?(this.makeItEasyButton.classList.add("active"),console.log("ðŸš€ MAKE IT EASY: Button activated - colors inverted")):(this.makeItEasyButton.classList.remove("active"),console.log("ðŸš€ MAKE IT EASY: Button deactivated - colors restored")))}resetAllFilters(){Object.keys(this.filterStates).forEach(t=>{this.filterStates[t]=!1,this.updateButtonStyles(t,!1)}),Object.entries(this.specialDivs).forEach(([t,e])=>{e&&this.originalDivStates[t]&&(e.style.display=this.originalDivStates[t])}),this.showAllItemsCSS(),this.needsOrderRestoration=!1;const t=document.getElementById("search-product-list");if(t&&t.value.trim().length>0){const e=t.value.trim();this.performSearchOptimized(e),console.log(`ðŸš€ PERFORMANCE: Filters reset but search reapplied: "${e}"`)}else this.restoreOriginalOrder(),console.log("ðŸš€ PERFORMANCE: All filters reset")}clearAllFilters(){window.searchManager&&window.searchManager.clearSearch&&window.searchManager.clearSearch(),Object.keys(this.config.exclusiveGroups).forEach(t=>{this.updateGroupStyles(t,null)}),Object.keys(this.filterStates).forEach(t=>{this.filterStates[t]=!1,this.updateButtonStyles(t,!1)}),Object.entries(this.specialDivs).forEach(([t,e])=>{e&&this.originalDivStates[t]&&(e.style.display=this.originalDivStates[t])}),this.showAllItemsCSS(),this.restoreOriginalOrder(),this.needsOrderRestoration=!1,window.customDropdown&&window.customDropdown.reset&&window.customDropdown.reset(),console.log("ðŸš€ PERFORMANCE: All filters and search cleared")}updateGroupStyles(t,e){const i=this.config.exclusiveGroups[t];i&&i.forEach(t=>{const i=document.querySelector(`[data-filter-parent-for="${t}"]`);i&&(e?t===e?(i.classList.add("filter-selected"),i.classList.remove("filter-disabled")):(i.classList.add("filter-disabled"),i.classList.remove("filter-selected")):(i.classList.remove("filter-selected"),i.classList.remove("filter-disabled")))})}resetFiltersOnly(){Object.keys(this.filterStates).forEach(t=>{this.filterStates[t]=!1,this.updateButtonStyles(t,!1)}),Object.entries(this.specialDivs).forEach(([t,e])=>{e&&this.originalDivStates[t]&&(e.style.display=this.originalDivStates[t])}),this.showAllItemsCSS(),this.needsOrderRestoration=!1,console.log("ðŸš€ PERFORMANCE: Filters reset (search input preserved)")}performSearchOptimized(t){if(!t)return void this.showAllItemsCSS();t.toLowerCase();const e=new Set;let i=0;this.productElements.forEach(s=>{const r=s.getAttribute("data-slug");if(e.has(r))return;const o=this.doesProductMatchSearch(s,t),n=s.closest(".w-dyn-item");n&&(n.classList.toggle("filter-hidden",!o),o&&i++),e.add(r)}),0===i&&this.showNoResultsMessage(),console.log(`ðŸš€ PERFORMANCE: Search complete - ${i} products found`)}doesProductMatchSearch(t,e){if(!e)return!0;const i=e.toLowerCase(),s=["data-name2","data-mint","data-metal","data-size","data-year","data-product-id"];for(const e of s){const s=t.getAttribute(e);if(s&&s.toLowerCase().includes(i))return!0}return!1}showNoResultsMessage(){if(!this.gridContainer)return;const t=document.createElement("div");t.style.width="100%",t.style.textAlign="center",t.style.padding="40px 20px",t.style.color="#666",t.style.fontSize="18px",t.innerHTML="No products found matching your search.",t.className="no-results-message",this.gridContainer.appendChild(t)}captureOriginalOrder(){if(!this.gridContainer)return;this.gridContainer.querySelectorAll(".w-dyn-item").forEach(t=>{const e=t.querySelector(".product-data");if(e){const t=e.getAttribute("data-slug");t&&!this.originalOrder.includes(t)&&this.originalOrder.push(t)}}),console.log(`ðŸš€ PERFORMANCE: Captured original order for ${this.originalOrder.length} products`)}restoreOriginalOrder(){if(!this.gridContainer||0===this.originalOrder.length)return;const t=document.createDocumentFragment();this.originalOrder.forEach(e=>{const i=this.gridContainer.querySelector(`[data-slug="${e}"]`);if(i){const e=i.closest(".w-dyn-item");e&&t.appendChild(e)}}),this.gridContainer.appendChild(t),(!this._lastLogTime||Date.now()-this._lastLogTime>2e3)&&(console.log(`ðŸš€ PERFORMANCE: Restored ${this.originalOrder.length} items to original order`),this._lastLogTime=Date.now())}setupGlobalNamespace(){window.filterControls=window.filterControls||{},window.filterControls.resetAllFilters=()=>this.resetAllFilters(),window.filterControls.resetFiltersOnly=()=>this.resetFiltersOnly(),window.filterControls.getActiveFilters=()=>Object.entries(this.filterStates).filter(([t,e])=>e).map(([t,e])=>t),window.filterControls.checkProductPassesFilters=t=>{const e=t.getAttribute("data-slug");return this.shouldShowAnyDataElementForSlug(e)},window.filterControls.hasActiveFilters=()=>Object.values(this.filterStates).some(t=>t)}}(window.FILTER_CONFIG)}),document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector("#price-ticker.price-ticker-buy");if(!t)return;const e=t.querySelectorAll(".our-prices-ticker");if(!e.length)return;if(t.querySelector(".price-ticker-wrapper"))return;const i=document.createElement("a");i.href="/live-prices/gold-price-nz",i.className="price-ticker-link";const s=document.createElement("div");s.className="price-ticker-wrapper",e.forEach(t=>{s.appendChild(t.cloneNode(!0))});const r=s.cloneNode(!0);r.className+=" price-ticker-clone",i.appendChild(s),i.appendChild(r),t.innerHTML="",t.appendChild(i),t.classList.add("price-ticker-running");new IntersectionObserver(e=>{t.classList.toggle("price-ticker-running",e[0].isIntersecting)},{threshold:.1}).observe(t)}),document.addEventListener("DOMContentLoaded",function(){console.log("Fast promo visibility script loaded");let t=null,e=null,i=null,s=new Map;const r=document.getElementById("test-button");function o(){if(window.filterControls&&window.filterControls.getActiveFilters){const e=window.filterControls.getActiveFilters().includes("checkbox_starter");t!==e&&(console.log("Starter filter is now "+(e?"ACTIVE":"INACTIVE")),t=e,e?n():a())}}function n(){s.size>0?s.forEach((t,e)=>{t.isStarter&&c(t.promoDiv)}):(i||(i=document.querySelectorAll(".product-data[data-getting-started]")),0!==i.length?i.forEach(t=>{const e=l(t);if(!e)return;const i=e.querySelector('[id="getting-started-promo"]');i&&c(i)}):console.log("No starter products found"))}function a(){s.size>0?s.forEach(t=>{t.promoDiv.style.display="none"}):(e||(e=document.querySelectorAll('[id="getting-started-promo"]')),e.forEach(t=>{t.style.display="none"}))}function l(t){let e=t.parentElement,i=0;for(;e&&i<10;){if(e.classList.contains("w-dyn-item"))return e;e=e.parentElement,i++}return null}function c(t){t.style.cssText="\n      display: block !important;\n      visibility: visible !important;\n      opacity: 1 !important;\n      height: auto !important;\n      overflow: visible !important;\n      position: relative !important;\n      width: 100% !important;\n      margin: 15px 0 !important;\n      padding: 20px !important;\n      background: #f8f9fa !important;\n      border: 1px solid #e0e0e0 !important;\n      border-radius: 8px !important;\n      z-index: 1 !important;\n    "}r&&(r.addEventListener("click",function(){console.log("Test button clicked - forcing all starter promos visible"),n()}),console.log("Test button found and handler attached")),e=document.querySelectorAll('[id="getting-started-promo"]'),i=document.querySelectorAll(".product-data[data-getting-started]"),e.forEach(t=>{const e=l(t);if(e){const i=e.querySelector(".product-data");if(i){const r=i.getAttribute("data-product-id");r&&s.set(r,{promoDiv:t,productData:i,container:e,isStarter:i.hasAttribute("data-getting-started")&&""!==i.getAttribute("data-getting-started").trim()})}}}),console.log(`Cached ${e.length} promo divs and ${i.length} starter products`),function(){const t=document.getElementById("checkbox_starter");t&&(t.addEventListener("change",function(){const t=this.checked;console.log(`Starter checkbox directly changed to: ${t}`),t?n():a()}),console.log("Added direct listener to checkbox_starter")),setInterval(o,1e3),function(){const t=new MutationObserver(function(t){this.mutationTimeout&&clearTimeout(this.mutationTimeout),this.mutationTimeout=setTimeout(()=>{let e=!1;t.forEach(function(t){"attributes"===t.type&&"class"===t.attributeName&&t.target.classList.contains("w-dyn-item")&&(e=!0)}),e&&o()},200)}),e=document.querySelectorAll(".w-dyn-item");e.forEach(e=>{t.observe(e,{attributes:!0})}),console.log(`Set up mutation observer for ${e.length} product containers`)}()}(),o(),setTimeout(o,100)}),document.addEventListener("DOMContentLoaded",function(){"use strict";new class{constructor(t){this.config=t,this.searchInput=null,this.searchIcon=null,this.searchTimeout=null,this.isSearchActive=!1,this.originalProducts=[],this.gridContainer=null,this.init()}init(){this.cacheElements(),this.cacheOriginalProducts(),this.bindEvents(),this.setupGlobalAccess(),console.log("ðŸš€ PERFORMANCE OPTIMIZED Search Manager initialized")}cacheElements(){this.searchInput=document.getElementById(this.config.inputId),this.searchIcon=document.getElementById(this.config.iconId),this.gridContainer=document.querySelector(".w-dyn-items.w-row"),this.searchInput||console.error(`Search input with ID '${this.config.inputId}' not found`),this.searchIcon||console.error(`Search icon with ID '${this.config.iconId}' not found`)}cacheOriginalProducts(){this.originalProducts=Array.from(document.querySelectorAll(".product-data")),console.log(`ðŸš€ PERFORMANCE: Cached ${this.originalProducts.length} products for search`)}bindEvents(){this.searchInput&&(this.searchInput.addEventListener("input",t=>{this.handleSearchInput(t.target.value)}),this.searchInput.addEventListener("keydown",t=>{"Escape"===t.key&&this.clearSearch(),"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),this.searchInput.blur(),console.log("Enter key pressed - form submission prevented"))})),this.searchIcon&&(this.searchIcon.style.cursor="pointer",this.searchIcon.addEventListener("click",()=>{this.handleIconClick()}))}handleSearchInput(t){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.performSearchOptimized(t.trim())},this.config.debounceDelay)}handleIconClick(){if(this.searchInput){const t=this.searchInput.value.trim();this.performSearchOptimized(t),this.searchInput.focus()}}performSearchOptimized(t){if((!this._lastSearchLogTime||Date.now()-this._lastSearchLogTime>1e3)&&(console.log(`ðŸš€ SEARCH: "${t}"`),this._lastSearchLogTime=Date.now()),!t)return void this.clearSearch();this.isSearchActive=!0;const e=this.filterProductsWithCSS(t);0===e&&this.showNoResultsMessage(),(0===e||e>=5)&&console.log(`ðŸš€ SEARCH: ${e} products found for "${t}"`)}filterProductsWithCSS(t){const e=t.toLowerCase(),i=new Set;let s=0;return this.originalProducts.forEach(t=>{const r=t.getAttribute("data-slug");if(i.has(r))return;const o=this.doesProductMatch(t,e);let n=!0;window.filterControls&&window.filterControls.checkProductPassesFilters&&(n=window.filterControls.checkProductPassesFilters(t));const a=o&&n,l=t.closest(".w-dyn-item");l&&(l.classList.toggle("filter-hidden",!a),a&&s++),i.add(r)}),s}doesProductMatch(t,e){const i=e.split(/\s+/).filter(t=>t.length>0);for(const e of i){let i=!1;for(const s of this.config.searchableAttributes){const r=t.getAttribute(s);if(r&&r.toLowerCase().includes(e)){i=!0;break}}if(!i)return!1}return i.length>0}clearExistingFilters(){}clearFiltersOnly(){window.filterControls&&window.filterControls.resetFiltersOnly&&(window.filterControls.resetFiltersOnly(),console.log("ðŸš€ PERFORMANCE: Filters cleared but search preserved"))}showAllItemsCSS(){this.originalProducts.forEach(t=>{const e=t.closest(".w-dyn-item");e&&e.classList.remove("filter-hidden")})}showNoResultsMessage(){if(!this.gridContainer)return;const t=this.gridContainer.querySelector(".no-results-message");t&&t.remove();const e=document.createElement("div");e.style.width="100%",e.style.textAlign="center",e.style.padding="40px 20px",e.style.color="#666",e.style.fontSize="18px",e.innerHTML="No products found matching your search.",e.className="no-results-message",this.gridContainer.appendChild(e)}clearSearch(){if(this.clearSearchInput(),this.isSearchActive=!1,this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.gridContainer){const t=this.gridContainer.querySelector(".no-results-message");t&&t.remove()}this.showAllItemsCSS(),this.clearExistingFilters(),console.log("ðŸš€ PERFORMANCE: Search cleared - showing all products")}clearSearchInput(){this.searchInput&&(this.searchInput.value="")}clearSearchState(){if(this.isSearchActive=!1,this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.gridContainer){const t=this.gridContainer.querySelector(".no-results-message");t&&t.remove()}this.showAllItemsCSS()}isActive(){return this.isSearchActive}getCurrentSearchTerm(){return this.searchInput?this.searchInput.value.trim():""}setupGlobalAccess(){window.searchManager=window.searchManager||{},window.searchManager.clearSearch=()=>this.clearSearch(),window.searchManager.clearSearchInput=()=>this.clearSearchInput(),window.searchManager.clearSearchState=()=>this.clearSearchState(),window.searchManager.isActive=()=>this.isActive(),window.searchManager.getCurrentTerm=()=>this.getCurrentSearchTerm(),window.searchManager.filterProductsWithCSS=t=>this.filterProductsWithCSS(t)}}({inputId:"search-product-list",iconId:"svg-icon-search",debounceDelay:300,searchableAttributes:["data-name2","data-mint","data-metal","data-size","data-year","data-product-id"]})}),document.addEventListener("DOMContentLoaded",function(){"use strict";const t=new class{constructor(t){this.config=t,this.dropdown=null,this.gridContainer=null,this.originalOrder=[],this.activeSortType=null,this.init()}init(){this.findDropdown()}findDropdown(){if(this.dropdown=document.getElementById(this.config.dropdownId),!this.dropdown)return console.log("Waiting for sort dropdown to be ready..."),void setTimeout(()=>this.findDropdown(),this.config.retryDelay);this.captureOriginalOrder(),this.bindEvents(),console.log("ðŸš€ PERFORMANCE OPTIMIZED Sort Manager initialized")}captureOriginalOrder(){if(this.gridContainer=document.querySelector(".w-dyn-items.w-row"),this.gridContainer){this.gridContainer.querySelectorAll(".w-dyn-item").forEach(t=>{const e=t.querySelector(".product-data");e&&this.originalOrder.push(e.getAttribute("data-slug"))}),console.log(`ðŸš€ PERFORMANCE: Found products container with ${this.originalOrder.length} products`)}else console.error("Could not find products container")}bindEvents(){this.dropdown.addEventListener("sortOperation",t=>{const{operation:e,resetFirst:i}=t.detail;this.handleSortSelection(e,i)})}handleSortSelection(t,e){console.log(`ðŸš€ PERFORMANCE: Sort selected: ${t}, resetFirst: ${e}`),e&&this.resetFilters(),"default"===t?this.restoreOriginalOrder():this.config.rules[t]?this.applySortRuleOptimized(t):console.warn(`Unknown sort type: ${t}`)}resetFilters(){window.filterControls&&window.filterControls.resetFiltersOnly&&(window.filterControls.resetFiltersOnly(),console.log("ðŸš€ PERFORMANCE: Filters reset by sort operation (search preserved)"))}applySortRuleOptimized(t){const e=this.config.rules[t];if(window.searchManager&&window.searchManager.isActive()){const t=window.searchManager.getCurrentTerm();t&&window.searchManager.filterProductsWithCSS(t)}if(!this.gridContainer)return void console.error("Grid container not found");const i=Array.from(this.gridContainer.querySelectorAll(".w-dyn-item:not(.filter-hidden)")),s=[];i.forEach(t=>{const i=t.querySelector(`[${e.attribute}]`);if(!i)return;const r=i.getAttribute(e.attribute),o=this.parseSortValue(r,e);null!==o&&s.push({element:t,value:o,rawValue:r})}),this.sortItems(s,e);const r=document.createDocumentFragment();s.forEach(t=>{r.appendChild(t.element)}),this.gridContainer.appendChild(r),this.activeSortType=t,console.log(`ðŸš€ PERFORMANCE: Sorted ${s.length} items by ${e.name}`)}parseSortValue(t,e){if("number"===e.type){const i=parseFloat(t.replace(/,/g,""));return isNaN(i)?"data-year"===e.attribute?-999:null:i}return t}sortItems(t,e){t.sort((t,i)=>"asc"===e.direction?t.value-i.value:i.value-t.value)}restoreOriginalOrder(){if(window.searchManager&&window.searchManager.isActive()){const t=window.searchManager.getCurrentTerm();t&&window.searchManager.filterProductsWithCSS(t)}if(this.gridContainer&&this.originalOrder.length>0){const t=document.createDocumentFragment();this.originalOrder.forEach(e=>{const i=this.gridContainer.querySelector(`[data-slug="${e}"]`);if(i){const e=i.closest(".w-dyn-item");e&&t.appendChild(e)}}),this.gridContainer.appendChild(t),console.log(`ðŸš€ PERFORMANCE: Restored ${this.originalOrder.length} items to original order`)}this.activeSortType=null,console.log("ðŸš€ PERFORMANCE: Default order restored")}getCurrentSort(){return this.activeSortType}refreshSort(){this.activeSortType&&this.config.rules[this.activeSortType]&&this.applySortRuleOptimized(this.activeSortType)}sortVisibleItems(t){const e=this.config.rules[t];if(!e||!this.gridContainer)return;const i=Array.from(this.gridContainer.querySelectorAll(".w-dyn-item:not(.filter-hidden)")),s=[];i.forEach(t=>{const i=t.querySelector(`[${e.attribute}]`);if(!i)return;const r=i.getAttribute(e.attribute),o=this.parseSortValue(r,e);null!==o&&s.push({element:t,value:o,rawValue:r})}),this.sortItems(s,e);const r=document.createDocumentFragment();s.forEach(t=>{r.appendChild(t.element)}),this.gridContainer.appendChild(r),console.log(`ðŸš€ PERFORMANCE: Sorted ${s.length} visible items by ${e.name}`)}}({dropdownId:"custom-filter",retryDelay:300,rules:{value:{attribute:"data-value",type:"number",direction:"asc",name:"Value (Best per Oz)"},latest:{attribute:"data-year",type:"number",direction:"desc",name:"Latest/2025 Coins"},"lowest-price":{attribute:"data-price-nzd",type:"number",direction:"asc",name:"Price: Low to High"},"highest-price":{attribute:"data-price-nzd",type:"number",direction:"desc",name:"Price: High to Low"},"lowest-weight":{attribute:"data-weight-grams",type:"number",direction:"asc",name:"Weight: Low to High"},"highest-weight":{attribute:"data-weight-grams",type:"number",direction:"desc",name:"Weight: High to Low"}}});window.sortManager=t});