document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("buy-back-product"),t=document.getElementById("cert-buy-back-heading");e&&t&&(e.style.cursor="pointer",e.addEventListener("click",function(e){e.preventDefault(),t.click();const n=t.getBoundingClientRect().top+window.pageYOffset-100;$("html, body").animate({scrollTop:n},1200,"swing")}));const n=[document.getElementById("brands-we-sell-linkv2"),document.getElementById("brands-we-sell-linkv4")],o=document.getElementById("brands-we-sell");o&&n.forEach(function(e){e&&(e.style.cursor="pointer",e.addEventListener("click",function(e){e.preventDefault(),o.click();const t=o.getBoundingClientRect().top+window.pageYOffset-100;$("html, body").animate({scrollTop:t},1200,"swing")}))});const i=document.getElementById("how-it-works-link"),d=document.getElementById("how-it-works");i&&d&&(i.style.cursor="pointer",i.addEventListener("click",function(e){e.preventDefault(),d.click();const t=d.getBoundingClientRect().top+window.pageYOffset-100;$("html, body").animate({scrollTop:t},1200,"swing")}))}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("product-name-full"),t=document.getElementById("quantity"),n=document.getElementById("total-price"),o=document.getElementById("zoho-id"),i=document.getElementById("price_nzd"),d=document.getElementById("image-url"),r=document.getElementById("website-url"),s=document.getElementById("product-name"),a=document.getElementById("metal"),l=document.getElementById("product-type"),c=document.getElementById("broker");function m(t,o=10){e?.textContent.trim()&&n?.textContent.trim()?t():o?setTimeout(()=>m(t,o-1),200):alert("Failed to load product details. Please try again.")}c?.addEventListener("click",function(c){c.preventDefault(),m(()=>{const c=e.textContent.trim(),m=parseInt(t.value,10)||1,u=n.textContent.trim(),p=o?.textContent.trim()||"",g=i?.textContent.trim()||"",y=new URLSearchParams({"product-name-full":c,quantity:m,"total-price":u,"zoho-id":p,price_nzd:g,"image-url":d?.textContent.trim()||"","website-url":r?.textContent.trim()||"","product-name":s?.textContent.trim()||"",metal:a?.textContent.trim()||"","product-type":l?.textContent.trim()||""});window.location.href=`/connect-dealer?${y.toString()}`})})}),document.addEventListener("DOMContentLoaded",function(){function e(){const e=window.innerWidth;return e<480?{fontSize:"1rem",bottomPosition:"20%",paddingTop:"5px",paddingBottom:"5px",paddingLeft:"10px",paddingRight:"10px",borderRadius:"10px"}:e>=480&&e<768?{fontSize:"1.125rem",bottomPosition:"20%",paddingTop:"5px",paddingBottom:"5px",paddingLeft:"10px",paddingRight:"10px",borderRadius:"15px"}:e>=768&&e<992?{fontSize:"1.5rem",bottomPosition:"20%",paddingTop:"8px",paddingBottom:"8px",paddingLeft:"15px",paddingRight:"15px",borderRadius:"25px"}:{fontSize:"2rem",bottomPosition:"20%",paddingTop:"10px",paddingBottom:"10px",paddingLeft:"20px",paddingRight:"20px",borderRadius:"30px"}}function t(){const t=setInterval(function(){const n=document.querySelector(".w-lightbox-container");if(n&&!document.querySelector(".lightbox-custom-text")){clearInterval(t);const o=e(),i=document.createElement("div");i.style.position="absolute",i.style.bottom=o.bottomPosition,i.style.left="0",i.style.right="0",i.style.textAlign="center",i.style.zIndex="9999",i.style.pointerEvents="none";const d=document.getElementById("product-name"),r=d?d.textContent:"Product Name",s=document.createElement("div");s.className="lightbox-custom-text",s.textContent=r,s.style.display="inline-block",s.style.color="white",s.style.fontFamily='"Times New Roman", Times, serif',s.style.fontSize=o.fontSize,s.style.textShadow="1px 1px 3px rgba(0,0,0,0.7)",s.style.backgroundColor="rgba(0, 0, 0, 0.4)",s.style.paddingTop=o.paddingTop,s.style.paddingBottom=o.paddingBottom,s.style.paddingLeft=o.paddingLeft,s.style.paddingRight=o.paddingRight,s.style.borderRadius=o.borderRadius,s.style.maxWidth="90%",i.appendChild(s),n.appendChild(i)}},100)}document.querySelectorAll(".product-header1_lightbox-link-2").forEach(e=>{e.addEventListener("click",function(){setTimeout(t,300)})}),document.addEventListener("click",function(e){if(e.target.closest(".w-lightbox-control")&&document.querySelector(".w-lightbox-container")){const e=document.querySelector(".lightbox-custom-text");if(e){const t=e.parentElement;t&&t.remove()}setTimeout(t,300)}}),window.addEventListener("resize",function(){const t=document.querySelector(".lightbox-custom-text");if(t){const n=e();t.style.fontSize=n.fontSize,t.style.paddingTop=n.paddingTop,t.style.paddingBottom=n.paddingBottom,t.style.paddingLeft=n.paddingLeft,t.style.paddingRight=n.paddingRight,t.style.borderRadius=n.borderRadius;const o=t.parentElement;o&&(o.style.bottom=n.bottomPosition)}})}),document.addEventListener("DOMContentLoaded",function(){const e=document.createElement("style");e.textContent="\n    .modal-overlay {\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.6);\n      backdrop-filter: blur(8px);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      z-index: 9999;\n      opacity: 0;\n      visibility: hidden;\n      transition: all 0.3s ease;\n    }\n\n    .modal-overlay.active {\n      opacity: 1;\n      visibility: visible;\n    }\n\n    .modal-content {\n      background: #ffffff;\n      border-radius: 16px;\n      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\n      max-width: 480px;\n      width: 90%;\n      max-height: 90vh;\n      overflow: hidden;\n      transform: translateY(30px) scale(0.95);\n      transition: all 0.3s ease;\n      position: relative;\n    }\n\n    .modal-overlay.active .modal-content {\n      transform: translateY(0) scale(1);\n    }\n\n    .modal-header {\n      padding: 24px 24px 0 24px;\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n    }\n\n    .modal-icon {\n      width: 48px;\n      height: 48px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      border-radius: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      margin-bottom: 16px;\n    }\n\n    .modal-close {\n      background: none;\n      border: none;\n      font-size: 24px;\n      color: #6b7280;\n      cursor: pointer;\n      padding: 4px;\n      line-height: 1;\n      transition: color 0.2s ease;\n    }\n\n    .modal-close:hover {\n      color: #374151;\n    }\n\n    .modal-body {\n      padding: 0 24px 24px 24px;\n    }\n\n    .modal-body h2 {\n      font-size: 24px;\n      font-weight: 600;\n      color: #111827;\n      margin: 0 0 12px 0;\n      line-height: 1.3;\n    }\n\n    .modal-body p {\n      font-size: 16px;\n      color: #6b7280;\n      line-height: 1.6;\n      margin: 0 0 24px 0;\n    }\n\n    .modal-actions {\n      display: flex;\n      gap: 12px;\n      flex-wrap: wrap;\n    }\n\n    .btn-primary, .btn-secondary {\n      padding: 12px 20px;\n      border-radius: 8px;\n      font-size: 14px;\n      font-weight: 500;\n      border: none;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      flex: 1;\n      min-width: 120px;\n    }\n\n    .btn-primary {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n    }\n\n    .btn-primary:hover {\n      transform: translateY(-1px);\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n    }\n\n    .btn-secondary {\n      background: #f3f4f6;\n      color: #374151;\n      border: 1px solid #e5e7eb;\n    }\n\n    .btn-secondary:hover {\n      background: #e5e7eb;\n      transform: translateY(-1px);\n    }\n\n    @media (max-width: 640px) {\n      .modal-content {\n        margin: 20px;\n        width: calc(100% - 40px);\n      }\n      \n      .modal-actions {\n        flex-direction: column;\n      }\n      \n      .btn-primary, .btn-secondary {\n        flex: none;\n        width: 100%;\n      }\n    }\n  ",document.head.appendChild(e);document.body.insertAdjacentHTML("beforeend",'\n    <div id="market-closed-modal" class="modal-overlay">\n      <div class="modal-content">\n        <div class="modal-header">\n          <div class="modal-icon">\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" fill="currentColor"/>\n            </svg>\n          </div>\n          <button class="modal-close" id="modal-close">&times;</button>\n        </div>\n        <div class="modal-body">\n          <h2>Market Currently Closed</h2>\n          <p>The market is closed. You can wait until trading recommences or speak to a broker during business hours for more options.</p>\n          <div class="modal-actions">\n            <button class="btn-secondary" id="wait-btn">Wait for Market Open</button>\n            <button class="btn-primary" id="contact-broker">Bullion Broker</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ');const t=document.getElementById("button-closed"),n=document.getElementById("market-closed-modal"),o=document.getElementById("modal-close"),i=document.getElementById("wait-btn"),d=document.getElementById("contact-broker");function r(){n.classList.remove("active"),document.body.style.overflow=""}t&&t.addEventListener("click",function(e){e.preventDefault(),n.classList.add("active"),document.body.style.overflow="hidden"}),o.addEventListener("click",r),n.addEventListener("click",function(e){e.target===n&&r()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&n.classList.contains("active")&&r()}),i.addEventListener("click",function(){r(),console.log("User chose to wait for market open")}),d.addEventListener("click",function(){window.location.href="/contact-us"})}),document.addEventListener("DOMContentLoaded",function(){[{trigger:"heading-menu-drop-mob-sub-jew",content:"site-links-sub-mob-jew",icon:"code-icon-58-jew"},{trigger:"heading-menu-drop-mob-sub-price",content:"site-links-sub-mob-price",icon:"code-icon-58-price"},{trigger:"heading-menu-drop-mob-sub-help",content:"site-links-sub-mob-help",icon:"code-icon-58-help"},{trigger:"heading-menu-drop-mob-sub-bul",content:"site-links-sub-mob-bul",icon:"code-icon-58-bul"},{trigger:"heading-menu-drop-mob-sub-jew2",content:"site-links-sub-mob-jew2",icon:"code-icon-58-jew2"}].forEach(function(e){!function(e,t,n){if(!e||!t||!n)return void console.warn("Missing element for dropdown",e,t,n);t.style.height="0px",t.style.opacity="0",t.style.overflow="hidden",t.style.transition="height 0.3s ease, opacity 0.3s ease",n.style.transition="transform 0.3s ease";let o=!1;function i(e){if(e.preventDefault(),o)t.style.height="0px",t.style.opacity="0",n.style.transform="rotateX(0deg)",o=!1;else{t.style.height="auto";const e=t.offsetHeight+"px";t.style.height="0px",setTimeout(function(){t.style.height=e,t.style.opacity="1",n.style.transform="rotateX(180deg)"},10),o=!0}}e.addEventListener("click",i)}(document.getElementById(e.trigger),document.getElementById(e.content),document.getElementById(e.icon))})});const COUNTDOWN_SECONDS=300,FIELDS_TO_UPDATE=["#price_nzd","#unit-price-nzd","#unit-gst"],minCounterEl=document.getElementById("min-counter"),secCounterEl=document.getElementById("sec-counter"),text=e=>e?e.textContent.trim():null;function fetchAndUpdatePrices(){const e=new XMLHttpRequest;e.open("GET",window.location.href,!0),e.onreadystatechange=()=>{if(4!==e.readyState||200!==e.status)return;const t=document.createElement("html");t.innerHTML=e.responseText;const n={};FIELDS_TO_UPDATE.forEach(e=>{const o=t.querySelector(e),i=document.querySelector(e);if(!o||!i)return;const d=text(o);d!==text(i)&&(i.textContent=d,n[e]=d)}),Object.keys(n).length&&document.dispatchEvent(new CustomEvent("price-refreshed",{detail:n}))},e.send()}function startCountdown(){if(!minCounterEl||!secCounterEl)return void setInterval(fetchAndUpdatePrices,3e5);let e=300;function t(){const t=Math.floor(e/60),n=e%60;minCounterEl.textContent=String(t).padStart(2,"0"),secCounterEl.textContent=String(n).padStart(2,"0"),--e<0&&(fetchAndUpdatePrices(),e=300)}t(),setInterval(t,1e3)}function initUserReviews(){console.log("User reviews script started.");const e=document.querySelectorAll(".user-review-block");console.log(`Found ${e.length} review blocks.`),e.forEach((e,t)=>{const n=e.querySelector(".hidden-user-review-data");if(n){const t=parseInt(n.getAttribute("data-stars"),10),o=e.querySelector(".stars-wrapper");if(o)for(let e=1;e<=5;e++){const n=o.querySelector("#star"+e);n&&(n.style.display=e<=t?"block":"none")}}else console.log(`Hidden data not found for review block ${t}.`)});const t=document.querySelector(".hidden-user-review-data");if(t){const e=parseFloat(t.getAttribute("data-average")),n=t.getAttribute("data-total-no-reviews"),o=document.getElementById("stars-average"),i=document.getElementById("total-no-reviews");o&&(o.textContent=e.toFixed(1)),i&&(i.textContent=n);const d=Math.floor(e),r=e%1>=.5;for(let e=1;e<=5;e++){const t=document.getElementById("star-ave"+e);t&&(t.style.display="none")}for(let e=1;e<=d;e++){const t=document.getElementById("star-ave"+e);t&&(t.style.display="block")}const s=document.getElementById("star-ave1-2");s&&(s.style.display=r?"block":"none");const a=document.getElementById("2-stars-average"),l=document.getElementById("2-total-no-reviews");a&&(a.textContent=e.toFixed(1)),l&&(l.textContent=n);for(let e=1;e<=5;e++){const t=document.getElementById("2-star-ave"+e);t&&(t.style.display="none")}for(let e=1;e<=d;e++){const t=document.getElementById("2-star-ave"+e);t&&(t.style.display="block")}const c=document.getElementById("2-star-ave1-2");c&&(c.style.display=r?"block":"none")}else console.log("First hidden data for average rating not found.")}document.addEventListener("DOMContentLoaded",()=>{fetchAndUpdatePrices(),startCountdown()}),function(){const e=document.getElementById("quantity"),t=document.getElementById("min-quantity-value"),n=document.getElementById("max-quantity-value"),o=document.getElementById("order-min"),i=document.getElementById("order-max"),d=document.getElementById("stock-level"),r=document.getElementById("price_nzd"),s=document.getElementById("total-price"),a=document.getElementById("unit-price-nzd"),l=document.getElementById("unit-gst"),c=document.getElementById("unit-total-price-nzd"),m=document.getElementById("unit-total-gst"),u=document.getElementById("gst-total"),p=document.getElementById("sub-total"),g=e=>parseFloat(String(e).replace(/[^0-9.\-]+/g,""))||0;function y(){const t=parseInt(e?.value,10)||1,n=g(a.textContent)*t,o=g(l.textContent)*t;r&&s&&(s.textContent=(g(r.textContent)*t).toFixed(2)),c&&(c.textContent=n.toFixed(2)),m&&(m.textContent=o.toFixed(2)),u&&(u.textContent=o.toFixed(2)),p&&(p.textContent=n.toFixed(2))}function f(t,n){const o=document.createElement("span");return o.className=n,o.textContent=t,o.style.display="none",e.parentNode.insertBefore(o,e.nextSibling),o}let x=null,b=null,h=!1;function v(){if(!e)return;let o=1;if(t){const e=parseInt(t.textContent.trim(),10);isNaN(e)||(o=e)}let i=1/0;if(n){const e=parseInt(n.textContent.trim(),10);isNaN(e)||(i=e)}let d=parseInt(e.value,10)||o;d<o&&(d=o),d>i&&(d=i),e.value=d,h&&(x&&(x.style.display=d<=o?"inline-block":"none"),b&&(b.style.display=d>=i?"inline-block":"none")),y()}document.addEventListener("DOMContentLoaded",()=>{if(!e)return;if(!document.getElementById("qty-limits-style")){const e=document.createElement("style");e.id="qty-limits-style",e.textContent="\n        .min-qty-message,\n        .max-qty-message {\n          margin-left: 5px;\n          font-size: 0.875rem;\n          line-height: 1;\n          vertical-align: middle;\n          color: #c00; /* red */\n        }\n      ",document.head.appendChild(e)}e.style.display="inline-block";let r=1/0;if(i){const e=parseInt(i.textContent.trim(),10);isNaN(e)||(r=e)}if(d){const e=parseInt(d.textContent.trim(),10);!isNaN(e)&&e>0&&e<r&&(r=e)}n&&r!==1/0&&(n.textContent=r);let s=1;if(o){const e=parseInt(o.textContent.trim(),10);isNaN(e)||(s=e)}else if(t){const e=parseInt(t.textContent.trim(),10);isNaN(e)||(s=e)}t&&o&&(t.textContent=s);let a=s;if((!e.value||parseInt(e.value,10)<a)&&(e.value=a),t){const n=parseInt(t.textContent.trim(),10);isNaN(n)||(e.setAttribute("min",n),x=f(`min: ${n}`,"min-qty-message"))}if(n){const t=parseInt(n.textContent.trim(),10);isNaN(t)||(e.setAttribute("max",t),b=f(`max: ${t}`,"max-qty-message"))}const l=()=>{h=!0,v()};e.addEventListener("keydown",e=>{"Enter"===e.key&&e.preventDefault(),"ArrowUp"!==e.key&&"ArrowDown"!==e.key||l()}),e.addEventListener("focus",l),e.addEventListener("click",l),e.addEventListener("wheel",l),e.addEventListener("input",l),e.addEventListener("change",l),document.addEventListener("price-refreshed",y),v()})}(),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("user-reviews-link"),t=document.getElementById("user-review-heading");e&&t&&(e.style.cursor="pointer",e.addEventListener("click",function(e){e.preventDefault(),t.click();const n=t.getBoundingClientRect().top+window.pageYOffset-100;$("html, body").animate({scrollTop:n},1200,"swing")}))});const observer=new MutationObserver((e,t)=>{const n=document.getElementById("user-reviews");n&&n.querySelector(".user-review-block")&&(initUserReviews(),t.disconnect())});observer.observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("user-reviews");e&&e.querySelector(".user-review-block")&&initUserReviews()});