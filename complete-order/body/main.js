const rootURL=window.location.origin;document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("paymentBank");e&&e.addEventListener("click",function(){function e(e){const t=document.getElementById(e);return t?"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value:t.textContent:""}const t=e("trade-order"),n=e("total-amount"),o=e("product-name-full"),a=e("order_creation_time"),r=`${rootURL}/transfer?trade-order=${encodeURIComponent(t)}&total-price=${encodeURIComponent(n)}&product-name-full=${encodeURIComponent(o)}&order_creation_time=${encodeURIComponent(a)}`;window.open(r,"_blank")})}),document.addEventListener("DOMContentLoaded",function(){try{const e=sessionStorage.getItem("product_url");if(console.log("Raw stored data:",e),!e)return void console.error("No data found in session storage");const t=JSON.parse(e);console.log("Outer data structure:",t);const n=t.value,o=JSON.parse(n);console.log("Product data:",o);const a=document.getElementById("breadcrumb-url");a&&o.url?(a.href=o.url.trim(),console.log("Updated breadcrumb URL to:",a.href)):console.error("Could not update breadcrumb URL");const r=document.getElementById("breadcrumb-text");if(r&&o.name?(r.textContent=o.name,console.log("Updated breadcrumb text to:",o.name)):console.error("Could not update breadcrumb text"),o.metal){const e=document.documentElement,t=o.metal.toLowerCase();"gold"===t?(e.style.setProperty("--gold_silver","#fff7e0"),e.style.setProperty("--gold_silver_background","#fffff6"),console.log("Set CSS variables for gold styling")):"silver"===t&&(e.style.setProperty("--gold_silver","#e6e6e6"),e.style.setProperty("--gold_silver_background","#f6f9ff"),console.log("Set CSS variables for silver styling")),console.log("CSS variables updated - elements using these variables will reflect the changes automatically")}}catch(e){console.error("Error processing data:",e)}});const DEV_URL="https://cuddly-space-waddle-4jgr5gxqj6wg3q6jr-3000.app.github.dev",STAGING_FALLBACK_URL="https://mware3-staging.up.railway.app",PROD_URL="https://mware3-production.up.railway.app",MAX_ATTEMPTS=5;async function isCodespaceAvailable(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e3),n=await fetch(DEV_URL+"/health",{method:"GET",signal:e.signal});return clearTimeout(t),n.ok}catch(e){return console.log("Codespace not available:",e.message),!1}}async function getApiBaseUrl(){if(window.location.hostname.includes("webflow.io")){console.log("Staging environment detected - checking codespace availability");return await isCodespaceAvailable()?(console.log("Using codespace DEV server"),DEV_URL):(console.log("Codespace unavailable - using railway staging server"),STAGING_FALLBACK_URL)}return console.log("Production environment detected - using PROD server"),PROD_URL}function getSessionDataWithExpiry(e){const t=sessionStorage.getItem(e);if(!t)return null;try{const n=JSON.parse(t);return(new Date).getTime()>n.expiry?(sessionStorage.removeItem(e),null):n.value}catch(t){return console.error(`Error parsing ${e}:`,t),null}}function sleep(e){return new Promise(t=>setTimeout(t,e))}function setInitialStates(){const e=document.querySelector("#paymentButton"),t=document.querySelector("#paymentBlinkpay"),n=document.querySelector("#paymentCreditcard"),o=document.querySelector("#paymentAlipay"),a=document.querySelector("#paymentWindcave"),r=document.querySelector("#pdf-checkmark"),s=document.querySelector("#paylink-checkmark");[e,t,n,o,a].forEach(e=>{e&&(e.innerHTML='\n                <span class="spinner"></span>\n                <span>Processing...</span>\n            ',e.classList.add("processing"))}),[r,s].forEach(e=>{e&&(e.dataset.originalContent=e.innerHTML,e.innerHTML="",e.classList.add("status-icon","processing"))})}function setCompletionState(){[document.querySelector("#pdf-checkmark"),document.querySelector("#paylink-checkmark")].forEach(e=>{e&&(e.classList.remove("processing","error"),e.classList.add("ready"),e.innerHTML=e.dataset.originalContent)})}function setErrorState(){[document.querySelector("#pdf-checkmark"),document.querySelector("#paylink-checkmark")].forEach(e=>{e&&(e.classList.remove("processing"),e.classList.add("error"),e.innerHTML='<svg width="30" height="30" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.493 0.015 C 7.442 0.021,7.268 0.039,7.107 0.055 C 5.234 0.242,3.347 1.208,2.071 2.634 C 0.660 4.211,-0.057 6.168,0.009 8.253 C 0.124 11.854,2.599 14.903,6.110 15.771 C 8.169 16.280,10.433 15.917,12.227 14.791 C 14.017 13.666,15.270 11.933,15.771 9.887 C 15.943 9.186,15.983 8.829,15.983 8.000 C 15.983 7.171,15.943 6.814,15.771 6.113 C 14.979 2.878,12.315 0.498,9.000 0.064 C 8.716 0.027,7.683 -0.006,7.493 0.015 M8.853 1.563 C 9.967 1.707,11.010 2.136,11.944 2.834 C 12.273 3.080,12.920 3.727,13.166 4.056 C 13.727 4.807,14.142 5.690,14.330 6.535 C 14.544 7.500,14.544 8.500,14.330 9.465 C 13.916 11.326,12.605 12.978,10.867 13.828 C 10.239 14.135,9.591 14.336,8.880 14.444 C 8.456 14.509,7.544 14.509,7.120 14.444 C 5.172 14.148,3.528 13.085,2.493 11.451 C 2.279 11.114,1.999 10.526,1.859 10.119 C 1.618 9.422,1.514 8.781,1.514 8.000 C 1.514 6.961,1.715 6.075,2.160 5.160 C 2.500 4.462,2.846 3.980,3.413 3.413 C 3.980 2.846,4.462 2.500,5.160 2.160 C 6.313 1.599,7.567 1.397,8.853 1.563" stroke="none" fill-rule="evenodd" fill="#e74c3c"></path></svg>')})}async function initializePaymentCheck(){const e=await getApiBaseUrl();console.log(`Using API URL: ${e}`);const t=document.querySelector("#paymentButton"),n=document.querySelector("#paymentBlinkpay"),o=document.querySelector("#paymentCreditcard"),a=document.querySelector("#paymentAlipay"),r=document.querySelector("#paymentWindcave");if(!(t&&n&&o&&a))return void console.error("ERROR: One or more required payment buttons not found");console.log("Waiting 5 seconds before starting payment check..."),await sleep(5e3),console.log("Starting initialization after 5-second delay");const s=getSessionDataWithExpiry("token");let c=0;if(!s)return console.error("ERROR: No order token found in sessionStorage or token has expired"),[t,n,o,a,r].forEach(e=>{e&&(e.innerHTML="Payment Option Not Available",e.classList.add("error"))}),void setErrorState();console.log("Starting payment status check for token:",s),await async function i(){if(c++,console.log(`Attempt ${c} of 5`),c>5){console.error("Maximum attempts reached");const e=[t,n,o,a];r&&e.push(r);const s=e.every(e=>!e.classList.contains("ready"));return e.forEach(e=>{e&&e.classList.contains("processing")&&(e.innerHTML="Payment link unavailable",e.classList.remove("processing"),e.classList.add("error"))}),void(s?setErrorState():setCompletionState())}try{const c=await fetch(`${e}/api/payment-status/${s}`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const d=await c.json();console.log("Payment status response:",d);let l=!1,m=!1,u=!1,p=!1,y=!1;if(d.payments){d.payments.POLi&&t&&(t.innerHTML="Pay with POLi",t.href=d.payments.POLi.payment_url,t.classList.remove("processing"),t.classList.add("ready"),l=!0),d.payments.BLINK&&n&&(n.innerHTML="Pay with Blink",n.href=d.payments.BLINK.payment_url,n.classList.remove("processing"),n.classList.add("ready"),m=!0),d.payments.STRIPE&&o&&(o.innerHTML="Pay with Credit Card",o.href=d.payments.STRIPE.payment_url,o.classList.remove("processing"),o.classList.add("ready"),u=!0),d.payments.ALIPAY&&a&&(a.innerHTML="Pay with Alipay",a.href=d.payments.ALIPAY.payment_url,a.classList.remove("processing"),a.classList.add("ready"),p=!0),d.payments.WINDCAVE&&r&&(r.innerHTML="Pay with Windcave",r.href=d.payments.WINDCAVE.payment_url,r.classList.remove("processing"),r.classList.add("ready"),y=!0);const e=l&&m&&u&&p&&(!r||y);if(l||m||u||p||y)return setCompletionState(),void(e||(await sleep(2e3),await i()))}console.log("Payment URLs not ready, waiting 2 seconds before next attempt"),await sleep(2e3),await i()}catch(e){if(console.error("Error checking payment status:",e),c<5)console.log("Retrying after error..."),await sleep(2e3),await i();else{const e=[t,n,o,a];r&&e.push(r);const s=e.every(e=>!e.classList.contains("ready"));e.forEach(e=>{e&&e.classList.contains("processing")&&(e.innerHTML="Error checking payment",e.classList.remove("processing"),e.classList.add("error"))}),s?setErrorState():setCompletionState()}}}()}function getSessionDataWithExpiry(e){const t=sessionStorage.getItem(e);if(!t)return null;try{const n=JSON.parse(t);return Date.now()>n.expiry?(sessionStorage.removeItem(e),null):n.value}catch(t){return console.error(`Error parsing ${e}:`,t),null}}window.Webflow=window.Webflow||[],window.Webflow.push(async function(){setInitialStates(),initializePaymentCheck().catch(e=>{console.error("Fatal error in payment checker:",e),setErrorState()})}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("radio1"),t=document.getElementById("radio2"),n=document.getElementById("radio3"),o=document.getElementById("radio4"),a=document.getElementById("radio5"),r=document.getElementById("radio6"),s=document.getElementById("radio7"),c=document.getElementById("radio8"),i=document.getElementById("hidden1"),d=document.getElementById("hidden2"),l=document.getElementById("hidden3"),m=document.getElementById("hidden4"),u=document.getElementById("hidden5"),p=document.getElementById("hidden6"),y=document.getElementById("hidden7"),h=document.getElementById("hidden8"),g=document.createElement("input");g.type="checkbox",g.id="customRadio1",g.className="customRadio",g.checked=!1;const f=document.createElement("input");f.type="checkbox",f.id="customRadio2",f.className="customRadio",f.checked=!1;const k=document.createElement("input");k.type="checkbox",k.id="customRadio3",k.className="customRadio",k.checked=!1;const E=document.createElement("input");E.type="checkbox",E.id="customRadio4",E.className="customRadio",E.checked=!1;const L=document.createElement("input");L.type="checkbox",L.id="customRadio5",L.className="customRadio",L.checked=!1;const v=document.createElement("input");v.type="checkbox",v.id="customRadio6",v.className="customRadio",v.checked=!1;const C=document.createElement("input");C.type="checkbox",C.id="customRadio7",C.className="customRadio",C.checked=!1;const _=document.createElement("input");function S(){i&&(i.style.display="none"),d&&(d.style.display="none"),l&&(l.style.display="none"),m&&(m.style.display="none"),u&&(u.style.display="none"),p&&(p.style.display="none"),y&&(y.style.display="none"),h&&(h.style.display="none")}function w(e){e!==g&&(g.checked=!1),e!==f&&(f.checked=!1),e!==k&&(k.checked=!1),e!==E&&(E.checked=!1),e!==L&&(L.checked=!1),e!==v&&(v.checked=!1),e!==C&&(C.checked=!1),e!==_&&(_.checked=!1)}_.type="checkbox",_.id="customRadio8",_.className="customRadio",_.checked=!1,e&&e.appendChild(g),t&&t.appendChild(f),n&&n.appendChild(k),o&&o.appendChild(E),a&&a.appendChild(L),r&&r.appendChild(v),s&&s.appendChild(C),c&&c.appendChild(_),g.addEventListener("change",function(){this.checked?(w(this),S(),i&&(i.style.display="block")):S()}),f.addEventListener("change",function(){this.checked?(w(this),S(),d&&(d.style.display="block")):S()}),k.addEventListener("change",function(){this.checked?(w(this),S(),l&&(l.style.display="block")):S()}),E.addEventListener("change",function(){this.checked?(w(this),S(),m&&(m.style.display="block")):S()}),L.addEventListener("change",function(){this.checked?(w(this),S(),u&&(u.style.display="block")):S()}),v.addEventListener("change",function(){this.checked?(w(this),S(),p&&(p.style.display="block")):S()}),C.addEventListener("change",function(){this.checked?(w(this),S(),y&&(y.style.display="block")):S()}),_.addEventListener("change",function(){this.checked?(w(this),S(),h&&(h.style.display="block")):S()})}),document.addEventListener("DOMContentLoaded",()=>{console.log("Script startingâ€¦");const e=getSessionDataWithExpiry("orderData");if(!e)return void console.log("Order data expired or not found");const t="string"==typeof e?JSON.parse(e):e;console.log("Parsed orderData:",t);const n=getSessionDataWithExpiry("trade_order"),o=getSessionDataWithExpiry("order_creation_time"),a=(e,t)=>{const n=document.getElementById(e);if(n){const o=null!=t?t:"";"value"in n&&(n.value=o),n.textContent=o,console.log(`Updated ${e} with ${o}`)}else console.log(`Could not find div: ${e}`)},r=t.products&&t.products[0]||{};console.log("Product data:",r),a("First_Name_Order",t.first_name_order),a("Last_Name_Order",t.last_name_order),a("Email_Order",t.email_order),a("Phone_Order",t.phone_order),a("delivery",t.delivery),a("pay-in-person",t.pay_in_person),a("checkbox-order",t.checkbox_order),a("address",t.address),a("message-order",t.message),a("date-picker-order",t.date_picker_order),a("time-picker-order",t.time_picker_order),a("collect",t.collect),a("trade-order",n),a("order_creation_time",o),a("token",getSessionDataWithExpiry("token")),a("product-name-full",r.name),a("quantity",r.quantity),a("zoho-id",r.zoho_id),a("unit-price-nzd",r.unit_price_nzd),a("unit-gst",r.unit_gst),a("unit-total-price-nzd",r.unit_total_price_nzd),a("total-price",r.total_price),a("total-amount",t.total_amount),a("gst-total",t.gst_total),a("shipping",t.shipping),a("sub-total",t.sub_total),a("First_Name_Order2",t.first_name_order),a("Last_Name_Order2",t.last_name_order),a("total-price2",r.total_price)});