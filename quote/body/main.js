document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("environment");e?location.hostname.includes("webflow.io")?e.value="STAGING":e.value="PRODUCTION":console.error("Environment input field with ID 'environment' not found.")}),document.addEventListener("DOMContentLoaded",()=>{const e=sessionStorage.getItem("productData");if(!e)return;const t=JSON.parse(e),r=(e,t)=>{const r=document.getElementById(e);r&&("value"in r&&(r.value=t),r.textContent=t)};function o(e,t){null!=t&&["","2","3"].forEach(r=>{const o=document.getElementById(e+r);o&&("value"in o&&(o.value=t),o.textContent=t)})}if(t.slug){const e=`/buy-gold-details/${t.slug}`,r=document.getElementById("breadcrumb-url");r&&(r.href=e);const o=document.getElementById("product-url-return");o&&(o.href=e);const n=document.getElementById("product-url-return2");n&&(n.href=e)}if(t.imageUrl){const e=document.getElementById("product-image");e&&(e.src=t.imageUrl);const r=document.getElementById("product-image2");r&&(r.src=t.imageUrl)}if(t.metal){const e=document.documentElement;"gold"===t.metal.toLowerCase()?(e.style.setProperty("--gold_silver","#fff8e3"),e.style.setProperty("--gold_silver_background","#fffff5")):"silver"===t.metal.toLowerCase()&&(e.style.setProperty("--gold_silver","#e6e6e6"),e.style.setProperty("--gold_silver_background","#f6f9ff"))}const n={"product-name":t.productName,slug:t.slug,"website-url":t.websiteUrl,"image-url":t.imageUrl,metal:t.metal,collect:t.collect,"cms-id":t.cmsId,year:t.year,mint:t.mint,size:t.size,"zoho-id":t.zohoId,"1-oz-gold-stock-level":t.stockLevelText,"market-status":t.marketStatus,"stock-status":t.stockStatus,"product-type":t.productType,"online-order":t.onlineOrder,shippingfee:t.shippingFee,market:t.market,sku:t.sku,"auto-supplier":t.autoSupplier,"supplier-item-id":t.supplierItemId,"supplier-availability":t.supplierAvailability,"supplier-isactivesell":t.supplierIsActiveSell,price_nzd:t.priceNzd};for(const[e,t]of Object.entries(n))r(e,t);o("product-name-full",t.productNameFull),o("quantity",t.quantity),o("unit-price-nzd",t.unitPriceNzd),o("unit-total-price-nzd",t.unitTotalPriceNzd),o("unit-gst",t.unitGst),o("unit-total-gst",t.unitTotalGst),o("gst-total",t.gstTotal),o("sub-total",t.subTotal),o("total-price",t.totalPrice),o("price-signed",t.priceSigned),o("total-amount",t.totalPrice),sessionStorage.removeItem("productData")});const DEV_URL="https://mware3-staging.up.railway.app",STAGING_FALLBACK_URL="https://mware3-staging.up.railway.app",PROD_URL="https://mware3-production.up.railway.app";async function isCodespaceAvailable(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e3),r=(await fetch(DEV_URL+"/health",{signal:e.signal})).ok;return clearTimeout(t),r}catch{return!1}}async function getApiBaseUrl(){return location.hostname.includes("webflow.io")?await isCodespaceAvailable()?DEV_URL:STAGING_FALLBACK_URL:PROD_URL}function setSessionDataWithExpiry(e,t,r){sessionStorage.setItem(e,JSON.stringify({value:t,expiry:Date.now()+6e4*r}))}function getSessionDataWithExpiry(e){const t=JSON.parse(sessionStorage.getItem(e)||"null");return!t||Date.now()>t.expiry?(sessionStorage.removeItem(e),null):t.value}document.addEventListener("DOMContentLoaded",async()=>{!function(){const e={name:document.getElementById("breadcrumb-text")?.textContent||"",url:document.getElementById("breadcrumb-url")?.href||"",metal:document.getElementById("metal")?.textContent||""};setSessionDataWithExpiry("product_url",JSON.stringify(e),30)}();const e=await getApiBaseUrl();console.log("Using API base URL:",e);const t=document.querySelector("#place-order-submit"),r=document.querySelector("#wf-form-quote");function o(e){let t=!0;const o={"first-name":"First name is required","last-name":"Last name is required",email:"Email is required",mobile:"Phone number is required"};if(Object.keys(o).forEach(e=>{const t=r.querySelector(`[name="${e}"]`);var o;t&&(o=t,o.parentElement.querySelector(".error-message")?.remove(),o.style.borderColor="")}),Object.entries(o).forEach(([o,n])=>{const s=r.querySelector(`[name="${o}"]`);e.get(o)?.trim()||(!function(e,t){const r=e.parentElement.querySelector(".error-message");r&&r.remove();const o=document.createElement("div");o.className="error-message",o.textContent=t,o.style.color="red",o.style.fontSize="12px",o.style.marginTop="10px",e.parentElement.appendChild(o),e.style.borderColor="red"}(s,n),t=!1)}),!e.get("product-name-full")){const e=document.getElementById("no-product-selected");e&&(e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"center"})),t=!1}return t}t&&r?t.addEventListener("click",async n=>{n.preventDefault();const s=new FormData(r);if(!o(s))return;let a=document.querySelector("#shipping")?.value.trim()||"0";"Shipping"!==s.get("delivery")&&(a="0");const i={first_name_order:s.get("first-name"),last_name_order:s.get("last-name")||"",email_order:s.get("email"),phone_order:s.get("mobile")||"",delivery:s.get("delivery")||"",pay_in_person:s.get("pay-in-person")||"",checkbox_order:s.get("checkbox-order")||"",address:s.get("address")||"",message:s.get("message")||"",date_picker_order:s.get("date-picker")||"",time_picker_order:document.getElementById("time-picker-24")?.value||s.get("time-picker")||"",total_amount:parseFloat(s.get("total-amount"))||0,gst_total:parseFloat(s.get("gst-total"))||0,sub_total:parseFloat(s.get("sub-total"))||0,shipping:parseFloat(a)||0,collect:s.get("collect")||"",environment:s.get("environment")||"",products:[{cms_id:s.get("cms-id")||"",name:s.get("product-name-full")||"",quantity:parseInt(s.get("quantity"),10)||0,unit_price_nzd:parseFloat(s.get("unit-price-nzd"))||0,unit_gst:parseFloat(s.get("unit-gst"))||0,unit_total_price_nzd:parseFloat(s.get("unit-total-price-nzd"))||0,unit_total_gst:parseFloat(s.get("unit-total-gst"))||0,total_price:parseFloat(s.get("total-price"))||0,price_signed:s.get("price-signed")||"",market:s.get("market")||"",market_status:s.get("market-status")||"",sku:s.get("sku")||"",auto_supplier:"true"===(s.get("auto-supplier")||"").toLowerCase(),supplier_item_id:s.get("supplier-item-id")||"",zoho_id:s.get("zoho-id")||"",stock_status:s.get("stock-status")||"",product_type:s.get("product-type")||"",supplier_availability:s.get("supplier-availability")||"",isactivesell:"true"===(s.get("supplier-isactivesell")||"").toLowerCase(),year:s.get("year")||"",size:s.get("size")||"",mint:s.get("mint")||"",stock_level:s.get("stock-level")||"",slug:s.get("slug")||""}]},l=function(e){const t=e.innerHTML;return e.innerHTML='Processing<span class="spinner"></span>',e.classList.add("button-processing"),e.disabled=!0,t}(t);try{const t=await fetch(`${e}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),o=await t.json();if(!o.token||!o.trade_order)throw new Error("Invalid response from server");setSessionDataWithExpiry("orderData",JSON.stringify(i),30),setSessionDataWithExpiry("token",o.token,30),setSessionDataWithExpiry("trade_order",o.trade_order,30),setSessionDataWithExpiry("order_creation_time",o.order_creation_time,30),document.getElementById("trade-order")?.setAttribute("value",o.trade_order),document.getElementById("trade-order-display")?.setAttribute("value",o.trade_order),(document.getElementById("submit-order")||r).click()}catch(e){console.error("Error:",e),u=l,(c=t).innerHTML=u,c.classList.remove("button-processing"),c.disabled=!1,t.textContent="Server-Error";const r=document.getElementById("server-error");r&&(r.style.display="block",r.scrollIntoView({behavior:"smooth",block:"center"}))}var c,u}):console.error("Required elements not found")});