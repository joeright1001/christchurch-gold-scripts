document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("environment");e?location.hostname.includes("webflow.io")?e.value="STAGING":e.value="PRODUCTION":console.error("Environment input field with ID 'environment' not found.")}),document.addEventListener("DOMContentLoaded",()=>{const e=e=>document.getElementById(e),t=e("checkbox-order"),o=e("pay-in-person"),n=e("total-price"),r=e("total-amount"),s=e("total-amount2");function a(){const e=parseFloat(n?.value||n?.textContent)||0;[r,s].forEach(t=>{t&&("value"in t&&(t.value=e.toFixed(2)),t.textContent=e.toFixed(2))})}function i(){t&&o&&(o.value=t.checked?"Selected":"Not-Selected")}t?.addEventListener("change",i);const l=new MutationObserver(a);n&&l.observe(n,{childList:!0,subtree:!0}),i(),a()}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("close-order-details-icon");e&&e.addEventListener("click",function(e){e.preventDefault();const t=document.getElementById("product-summary-table");if(t){const e=t.getBoundingClientRect().top+window.pageYOffset,o=window.pageYOffset,n=e-o,r=700;let s=null;requestAnimationFrame(function e(t){null===s&&(s=t);const a=t-s,i=(l=a,c=o,d=n,(l/=r/2)<1?d/2*l*l+c:(l--,-d/2*(l*(l-2)-1)+c));var l,c,d;window.scrollTo(0,i),a<r&&requestAnimationFrame(e)})}})});const DEV_URL="https://cuddly-space-waddle-4jgr5gxqj6wg3q6jr-3000.app.github.dev",STAGING_FALLBACK_URL="https://mware3-staging.up.railway.app",PROD_URL="https://mware3-production.up.railway.app";async function isCodespaceAvailable(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e3),o=(await fetch(DEV_URL+"/health",{signal:e.signal})).ok;return clearTimeout(t),o}catch{return!1}}async function getApiBaseUrl(){return location.hostname.includes("webflow.io")?await isCodespaceAvailable()?DEV_URL:STAGING_FALLBACK_URL:PROD_URL}function setSessionDataWithExpiry(e,t,o){sessionStorage.setItem(e,JSON.stringify({value:t,expiry:Date.now()+6e4*o}))}function getSessionDataWithExpiry(e){const t=JSON.parse(sessionStorage.getItem(e)||"null");return!t||Date.now()>t.expiry?(sessionStorage.removeItem(e),null):t.value}document.addEventListener("DOMContentLoaded",async()=>{!function(){const e={name:document.getElementById("breadcrumb-text")?.textContent||"",url:document.getElementById("breadcrumb-url")?.href||"",metal:document.getElementById("metal")?.textContent||""};setSessionDataWithExpiry("product_url",JSON.stringify(e),30)}();const e=await getApiBaseUrl();console.log("Using API base URL:",e);const t=document.querySelector("#get-quote-submit"),o=document.querySelector("#wf-form-bullion-quote");function n(e){let t=!0;const n={"first-name":"First name is required","last-name":"Last name is required",email:"Email is required",mobile:"Phone number is required"};if(Object.keys(n).forEach(e=>{const t=o.querySelector(`[name="${e}"]`);var n;t&&(n=t,n.parentElement.querySelector(".error-message")?.remove(),n.style.borderColor="")}),Object.entries(n).forEach(([n,r])=>{const s=o.querySelector(`[name="${n}"]`);e.get(n)?.trim()||(!function(e,t){const o=e.parentElement.querySelector(".error-message");o&&o.remove();const n=document.createElement("div");n.className="error-message",n.textContent=t,n.style.color="red",n.style.fontSize="12px",n.style.marginTop="10px",e.parentElement.appendChild(n),e.style.borderColor="red"}(s,r),t=!1)}),!e.get("product-name-full")){const e=document.getElementById("no-product-selected");e&&(e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"center"})),t=!1}return t}t&&o?t.addEventListener("click",async r=>{r.preventDefault();const s=new FormData(o);if(!n(s))return;const a={first_name_order:s.get("first-name"),last_name_order:s.get("last-name")||"",email_order:s.get("email"),phone_order:s.get("mobile")||"",pay_in_person:s.get("pay-in-person")||"",message:s.get("message")||"",total_amount:parseFloat(s.get("total-amount"))||0,gst_total:parseFloat(s.get("gst-total"))||0,sub_total:parseFloat(s.get("sub-total"))||0,environment:s.get("environment")||"",products:[{cms_id:s.get("cms-id")||"",name:s.get("product-name-full")||"",quantity:parseInt(s.get("quantity"),10)||0,unit_price_nzd:parseFloat(s.get("unit-price-nzd"))||0,unit_gst:parseFloat(s.get("unit-gst"))||0,unit_total_price_nzd:parseFloat(s.get("unit-total-price-nzd"))||0,unit_total_gst:parseFloat(s.get("unit-total-gst"))||0,total_price:parseFloat(s.get("total-price"))||0,price_signed:s.get("price-signed")||"",market:s.get("market")||"",market_status:s.get("market-status")||"",sku:s.get("sku")||"",auto_supplier:"true"===(s.get("auto-supplier")||"").toLowerCase(),supplier_item_id:s.get("supplier-item-id")||"",zoho_id:s.get("zoho-id")||"",stock_status:s.get("stock-status")||"",product_type:s.get("product-type")||"",supplier_availability:s.get("supplier-availability")||"",isactivesell:"true"===(s.get("supplier-isactivesell")||"").toLowerCase(),year:s.get("year")||"",size:s.get("size")||"",mint:s.get("mint")||"",stock_level:s.get("stock-level")||"",slug:s.get("slug")||""}]},i=function(e){const t=e.innerHTML;return e.innerHTML='Processing<span class="spinner"></span>',e.classList.add("button-processing"),e.disabled=!0,t}(t);try{const t=await fetch(`${e}/create-quote`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await t.json();if(!n.token||!n.trade_order)throw new Error("Invalid response from server");setSessionDataWithExpiry("quoteData",JSON.stringify(a),30),setSessionDataWithExpiry("token",n.token,30),setSessionDataWithExpiry("trade_order",n.trade_order,30),setSessionDataWithExpiry("quote_creation_time",n.order_creation_time,30),document.getElementById("trade-order")?.setAttribute("value",n.trade_order),document.getElementById("trade-order-display")?.setAttribute("value",n.trade_order),(document.getElementById("submit-quote")||o).click()}catch(e){console.error("Error:",e),c=i,(l=t).innerHTML=c,l.classList.remove("button-processing"),l.disabled=!1,t.textContent="Server-Error";const o=document.getElementById("server-error");o&&(o.style.display="block",o.scrollIntoView({behavior:"smooth",block:"center"}))}var l,c}):console.error("Required elements not found")}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("submit-quote"),t=document.getElementById("product-name-full"),o=document.getElementById("no-product-selected");e&&t&&o&&e.addEventListener("click",function(e){t.value.trim()||(e.preventDefault(),o.style.display="block",o.scrollIntoView({behavior:"smooth",block:"center"}))})}),document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search),t=t=>e.get(t)||"",o=t("slug");if(o){document.querySelectorAll(".w-dyn-item").forEach(e=>{e.style.display="none"});const e=document.getElementById(o);if(e){const t=e.closest(".w-dyn-item");if(t){t.style.display="block";const e=`/buy-gold-details/${o}`,n=document.getElementById("breadcrumb-url");n&&(n.href=e);const r=document.getElementById("product-url-return");r&&(r.href=e);t.querySelectorAll('div[class^="cms-product-"]').forEach(e=>{const t=e.className.split("-");if(t.length>=3){const o=t.slice(2).join("-"),n=e.textContent.trim(),r=document.getElementById(o);r&&(r.value=n)}});const s=t.querySelector(".cms-product-image-url");if(s){const e=s.textContent.trim(),t=document.getElementById("product-image");t&&e&&(t.src=e)}const a=t.querySelector(".cms-product-metal");if(a){const e=a.textContent.toLowerCase(),t=document.documentElement;"gold"===e?(t.style.setProperty("--gold_silver","#fff8e3"),t.style.setProperty("--gold_silver_background","#fffff5")):"silver"===e&&(t.style.setProperty("--gold_silver","#e6e6e6"),t.style.setProperty("--gold_silver_background","#f6f9ff"))}}}}function n(e,t){t&&["","2"].forEach(o=>{const n=document.getElementById(e+o);n&&("value"in n&&(n.value=t),n.textContent=t)})}["quantity","unit-price-nzd","unit-total-price-nzd","unit-gst","unit-total-gst","gst-total","sub-total","total-price","price_nzd","price-signed","product-name-full"].forEach(e=>{n(e,t(e))}),n("gst-total",t("gst-total")),n("total-amount",t("total-price")),window.location.search&&window.history.replaceState({},"",window.location.pathname)});