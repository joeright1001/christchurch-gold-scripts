document.addEventListener("DOMContentLoaded",()=>{const e=e=>document.getElementById(e),t=e("checkbox-order"),n=e("pay-in-person"),r=e("date-picker-order"),o=e("delivery"),a=e("address"),i=e("shipping"),s=e("existing-order"),l=e("total-price"),c=e("shippingfee"),d=e("total-amount"),u=e("total-amount2");function m(){const e=parseFloat(l?.value||l?.textContent)||0,t=parseFloat(c?.value)||0,n=i&&"true"===i.value?e+t:e;[d,u].forEach(e=>{e&&("value"in e&&(e.value=n.toFixed(2)),e.textContent=n.toFixed(2))})}function p(){a?.value.trim()&&r?.value&&o&&!s?.checked&&(o.value="Error_both")}function g(){a?.value.trim()?(i&&(i.value="true"),o&&!s?.checked&&(o.value="Shipping")):(i&&(i.value="false"),o&&!s?.checked&&(o.value="")),p(),m()}function y(){s&&o&&(s.checked?o.value="Existing_order":a?.value.trim()?o.value="Shipping":o.value="",m())}function v(){r?.value&&o&&!s?.checked&&(o.value="Collect"),p(),m()}function h(){t&&n&&(n.value=t.checked?"Selected":"Not-Selected")}a?.addEventListener("blur",g),a?.addEventListener("change",g),r?.addEventListener("blur",v),t?.addEventListener("change",h),s?.addEventListener("change",()=>{y(),p()}),c?.addEventListener("input",m),i?.addEventListener("change",m),s?.checked?y():(a?.value.trim()&&g(),r?.value&&v()),h(),m()}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("close-order-details-icon");e&&e.addEventListener("click",function(e){e.preventDefault();const t=document.getElementById("product-summary-table");if(t){const e=t.getBoundingClientRect().top+window.pageYOffset,n=window.pageYOffset,r=e-n,o=700;let a=null;requestAnimationFrame(function e(t){null===a&&(a=t);const i=t-a,s=(l=i,c=n,d=r,(l/=o/2)<1?d/2*l*l+c:(l--,-d/2*(l*(l-2)-1)+c));var l,c,d;window.scrollTo(0,s),i<o&&requestAnimationFrame(e)})}})});const DEV_URL="https://mware3-staging.up.railway.app",STAGING_FALLBACK_URL="https://mware3-staging.up.railway.app",PROD_URL="https://mware3-production.up.railway.app";async function isCodespaceAvailable(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),1e3),n=(await fetch(DEV_URL+"/health",{signal:e.signal})).ok;return clearTimeout(t),n}catch{return!1}}async function getApiBaseUrl(){return location.hostname.includes("webflow.io")?await isCodespaceAvailable()?DEV_URL:STAGING_FALLBACK_URL:PROD_URL}function setSessionDataWithExpiry(e,t,n){sessionStorage.setItem(e,JSON.stringify({value:t,expiry:Date.now()+6e4*n}))}function getSessionDataWithExpiry(e){const t=JSON.parse(sessionStorage.getItem(e)||"null");return!t||Date.now()>t.expiry?(sessionStorage.removeItem(e),null):t.value}document.addEventListener("DOMContentLoaded",async()=>{!function(){const e={name:document.getElementById("breadcrumb-text")?.textContent||"",url:document.getElementById("breadcrumb-url")?.href||"",metal:document.getElementById("metal")?.textContent||""};setSessionDataWithExpiry("product_url",JSON.stringify(e),30)}();const e=await getApiBaseUrl();console.log("Using API base URL:",e);const t=document.querySelector("#place-quote-submit"),n=document.querySelector("#wf-form-bullion-quote");function r(e){let t=!0;const r={"first-name":"First name is required","last-name":"Last name is required",email:"Email is required",mobile:"Phone number is required"};if(Object.keys(r).forEach(e=>{const t=n.querySelector(`[name="${e}"]`);var r;t&&(r=t,r.parentElement.querySelector(".error-message")?.remove(),r.style.borderColor="")}),Object.entries(r).forEach(([r,o])=>{const a=n.querySelector(`[name="${r}"]`);e.get(r)?.trim()||(!function(e,t){const n=e.parentElement.querySelector(".error-message");n&&n.remove();const r=document.createElement("div");r.className="error-message",r.textContent=t,r.style.color="red",r.style.fontSize="12px",r.style.marginTop="10px",e.parentElement.appendChild(r),e.style.borderColor="red"}(a,o),t=!1)}),!e.get("product-name-full")){const e=document.getElementById("no-product-selected");e&&(e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"center"})),t=!1}return t}t&&n?t.addEventListener("click",async o=>{o.preventDefault();const a=new FormData(n);if(!r(a))return;let i=document.querySelector("#shippingfee")?.value.trim()||"";"true"!==a.get("delivery")&&(i="0");const s={first_name_order:a.get("first-name"),last_name_order:a.get("last-name")||"",email_order:a.get("email"),phone_order:a.get("mobile")||"",product_name_full:a.get("product-name-full")||"",quantity:a.get("quantity")||"",price_nzd:a.get("price_nzd")||"",zoho_id:a.get("zoho-id")||"",collect:a.get("collect")||"",delivery:a.get("delivery")||"",pay_in_person:a.get("pay-in-person")||"",checkbox_order:a.get("checkbox-order")||"",address:a.get("address")||"",message:a.get("message")||"",date_picker_order:a.get("date-picker")||"",time_picker_order:a.get("time-picker")||"",total_price:a.get("total-price")||"",total_amount:a.get("total-amount")||"",shippingfee:i,unit_gst:a.get("unit-gst")||"",total_gst:a.get("total-gst")||"",unit_price_nzd:a.get("unit-price-nzd")||"",total_unit_price_nzd:a.get("total-unit-price-nzd")||"",supplier_status:a.get("market-status")||"",supplier_name:a.get("market")||"",sku:a.get("sku")||"",auto_supplier:a.get("auto-supplier")||"",supplier_item_id:a.get("supplier-item-id")||""},l=function(e){const t=e.innerHTML;return e.innerHTML='Processing<span class="spinner"></span>',e.classList.add("button-processing"),e.disabled=!0,t}(t);try{const t=await fetch(`${e}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await t.json();if(!r.token||!r.trade_order)throw new Error("Invalid response from server");setSessionDataWithExpiry("orderData",JSON.stringify(s),30),setSessionDataWithExpiry("token",r.token,30),setSessionDataWithExpiry("trade_order",r.trade_order,30),setSessionDataWithExpiry("order_creation_time",r.order_creation_time,30),document.getElementById("trade-order")?.setAttribute("value",r.trade_order),document.getElementById("trade-order-display")?.setAttribute("value",r.trade_order),(document.getElementById("submit-quote")||n).click()}catch(e){console.error("Error:",e),d=l,(c=t).innerHTML=d,c.classList.remove("button-processing"),c.disabled=!1,t.textContent="Server-Error";const n=document.getElementById("server-error");n&&(n.style.display="block",n.scrollIntoView({behavior:"smooth",block:"center"}))}var c,d}):console.error("Required elements not found")}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("submit-quote"),t=document.getElementById("product-name-full"),n=document.getElementById("no-product-selected");e&&t&&n&&e.addEventListener("click",function(e){t.value.trim()||(e.preventDefault(),n.style.display="block",n.scrollIntoView({behavior:"smooth",block:"center"}))})}),document.addEventListener("DOMContentLoaded",()=>{function e(e,t){t&&["","2"].forEach(n=>{const r=document.getElementById(e+n);r&&("value"in r&&(r.value=t),r.textContent=t)})}const t=new URLSearchParams(window.location.search),n=e=>t.get(e)||"";e("product-name-full",n("product-name-full")),e("quantity",n("quantity")),e("total-price",n("total-price")),e("zoho-id",n("zoho-id")),e("collect",n("collect")),e("price_nzd",n("price-nzd")),e("unit-gst",n("unit-gst")),e("total-gst",n("total-gst")),e("gst-total",n("total-gst")),e("unit-price-nzd",n("unit-price-nzd")),e("total-unit-price-nzd",n("total-unit-price-nzd")),e("shippingfee",n("shippingfee")),e("market-status",n("market-status")),e("market",n("market")),e("sku",n("sku")),e("auto-supplier",n("auto-supplier")),e("supplier-item-id",n("supplier-item-id"));const r=n("image-url");if(r){const e=document.getElementById("product-image");e&&(e.src=r)}const o=n("website-url");if(o){const e=new URL(`/buy-gold-details/${o}`,window.location.origin).href;["product-url-return","breadcrumb-url","breadcrumb-url2"].forEach(t=>{const n=document.getElementById(t);n&&(n.href=e)})}e("breadcrumb-text",n("product-name"));const a=n("product-type").toLowerCase();"supplier"===a&&document.getElementById("in-stock-place-order-text")?.style.setProperty("display","none"),"investor"===a&&(document.getElementById("live-at-mint-order-text")?.style.setProperty("display","none"),document.getElementById("checkbox-supplier-block")?.style.setProperty("display","none")),e("total-amount",n("total-price")),window.history.replaceState({},"",window.location.pathname)});