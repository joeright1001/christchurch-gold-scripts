document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("submit-order"),t=document.getElementById("product-name-full"),n=document.getElementById("no-product-selected");e&&t&&n&&e.addEventListener("click",e=>{t.value.trim()||(e.preventDefault(),n.style.display="block",n.scrollIntoView({behavior:"smooth",block:"center"}))})}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("post-collect"),t=document.getElementById("address");if(!e||!t)return void console.error("Required inputs not found");const n=document.createElement("select");n.id="form_field_deliveryLocation",n.className="form-select location-dropdown";const o=document.createElement("option");o.textContent="-- Please Select --",o.value="",n.appendChild(o),Object.entries({}).forEach(([e,t])=>{const o=document.createElement("optgroup");o.label=e,t.forEach(e=>{const t=document.createElement("option");t.value=t.textContent=e,o.appendChild(t)}),n.appendChild(o)}),n.addEventListener("change",function(){const n=this.value;e.value=n,t.value=n,e.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))}),e.parentNode.insertBefore(n,e),e.style.display="none";const r=document.createElement("style");r.textContent="\n      .location-dropdown {\n        width:100%;padding:12px 16px;font-size:16px;color:#6b7280;\n        background:#fff;border:1px solid #d1d5db;border-radius:8px;\n        outline:none;transition:.2s;cursor:pointer;\n        -webkit-appearance:none;-moz-appearance:none;appearance:none;\n        background-image:url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\");\n        background-repeat:no-repeat;background-position:right 12px center;\n        background-size:20px;padding-right:40px;\n      }\n      .location-dropdown:hover{border-color:#9ca3af;box-shadow:0 1px 3px rgba(0,0,0,.1);}\n      .location-dropdown:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1);color:#111827;}\n      .location-dropdown option{padding:8px 12px;color:#374151;}\n      .location-dropdown optgroup{font-weight:600;color:#111827;padding-top:8px;}\n      .location-dropdown option:hover{background:#f3f4f6;}\n      .location-dropdown:not(:invalid){color:#111827;}\n    ",document.head.appendChild(r)}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("close-order-details-icon");e&&e.addEventListener("click",function(e){e.preventDefault();const t=document.getElementById("product-summary-table");if(!t)return;const n=window.pageYOffset,o=t.getBoundingClientRect().top+n-n;let r=null;requestAnimationFrame(function e(t){null===r&&(r=t);const a=t-r;var i,c,d;window.scrollTo(0,(i=a,c=n,d=o,(i/=700/2)<1?d/2*i*i+c:-d/2*(--i*(i-2)-1)+c)),a<700&&requestAnimationFrame(e)})})});const DEV_URL="https://cuddly-space-waddle-4jgr5gxqj6wg3q6jr-3000.app.github.dev",STAGING_FALLBACK_URL="https://mware3-staging.up.railway.app",PROD_URL="https://mware3-production.up.railway.app";async function isCodespaceAvailable(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),3e3),n=(await fetch(DEV_URL+"/health",{signal:e.signal})).ok;return clearTimeout(t),n}catch{return!1}}async function getApiBaseUrl(){return location.hostname.includes("webflow.io")?await isCodespaceAvailable()?DEV_URL:STAGING_FALLBACK_URL:PROD_URL}function setSessionDataWithExpiry(e,t,n){sessionStorage.setItem(e,JSON.stringify({value:t,expiry:Date.now()+6e4*n}))}function getSessionDataWithExpiry(e){const t=JSON.parse(sessionStorage.getItem(e)||"null");return!t||Date.now()>t.expiry?(sessionStorage.removeItem(e),null):t.value}document.addEventListener("DOMContentLoaded",async()=>{!function(){const e={name:document.getElementById("breadcrumb-text")?.textContent||"",url:document.getElementById("breadcrumb-url")?.href||"",metal:document.getElementById("metal")?.textContent||""};setSessionDataWithExpiry("product_url",JSON.stringify(e),30)}();const e=await getApiBaseUrl();console.log("Using API base URL:",e);const t=document.querySelector("#place-order-submit"),n=document.querySelector("#wf-form-bullion-order");function o(e,t){const n=e.parentElement.querySelector(".error-message");n&&n.remove();const o=document.createElement("div");o.className="error-message",o.textContent=t,o.style.color="red",o.style.fontSize="12px",o.style.marginTop="10px",e.parentElement.appendChild(o),e.style.borderColor="red"}function r(e){e.parentElement.querySelector(".error-message")?.remove(),e.style.borderColor=""}t&&n?t.addEventListener("click",async a=>{a.preventDefault();const i=new FormData(n);if(!function(e){let t=!0;const a={"first-name":"First name is required","last-name":"Last name is required",email:"Email is required",mobile:"Phone number is required"};Object.keys(a).forEach(e=>{const t=n.querySelector(`[name="${e}"]`);t&&r(t)}),Object.entries(a).forEach(([r,a])=>{const i=n.querySelector(`[name="${r}"]`);e.get(r)?.trim()||(o(i,a),t=!1)});const i=document.getElementById("product-type"),c=document.getElementById("checkbox-supplier")||n.querySelector('[name="checkbox-supplier"]'),d=document.getElementById("checkbox-supplier-block");if(i&&c&&d&&(r(d),"supplier"!==i.textContent.toLowerCase().trim()||c.checked||(o(d,"Please agree to supply ID if required"),t=!1)),!e.get("product-name-full")){const e=document.getElementById("no-product-selected");e&&(e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"center"})),t=!1}return t}(i))return;const c=document.querySelector("#shippingfee")?.value.trim()||"",d={first_name_order:i.get("first-name"),last_name_order:i.get("last-name")||"",email_order:i.get("email"),phone_order:i.get("mobile")||"",product_name_full:i.get("product-name-full")||"",quantity:i.get("quantity")||"",price_nzd:i.get("price_nzd")||"",zoho_id:i.get("zoho-id")||"",delivery:i.get("delivery")||"",pay_in_person:i.get("pay-in-person")||"",checkbox_order:i.get("checkbox-order")||"",address:i.get("address")||"",message:i.get("message")||"",date_picker_order:i.get("date-picker")||"",time_picker_order:i.get("time-picker")||"",total_price:i.get("total-price")||"",total_amount:i.get("total-amount")||"",shippingfee:c,unit_gst:i.get("unit-gst")||"",total_gst:i.get("total-gst")||"",unit_price_nzd:i.get("unit-price-nzd")||"",total_unit_price_nzd:i.get("total-unit-price-nzd")||"",supplier_status:i.get("market-status")||"",supplier_name:i.get("market")||"",sku:i.get("sku")||"",auto_supplier:i.get("auto-supplier")||"",supplier_item_id:i.get("supplier-item-id")||""},l=function(e){const t=e.innerHTML;return e.innerHTML='Processing<span class="spinner"></span>',e.classList.add("button-processing"),e.disabled=!0,t}(t);try{const t=await fetch(`${e}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),o=await t.json();if(!o.token||!o.trade_order)throw new Error("Invalid response from server");setSessionDataWithExpiry("orderData",JSON.stringify(d),30),setSessionDataWithExpiry("token",o.token,30),setSessionDataWithExpiry("trade_order",o.trade_order,30),setSessionDataWithExpiry("order_creation_time",o.order_creation_time,30),document.getElementById("trade-order")?.setAttribute("value",o.trade_order),document.getElementById("trade-order-display")?.setAttribute("value",o.trade_order),(document.getElementById("submit-order")||n).click()}catch(e){console.error("Error:",e),u=l,(s=t).innerHTML=u,s.classList.remove("button-processing"),s.disabled=!1,t.textContent="Server-Error";const n=document.getElementById("server-error");n&&(n.style.display="block",n.scrollIntoView({behavior:"smooth",block:"center"}))}var s,u}):console.error("Required elements not found")});const styleTimePicker=document.createElement("style");function startLocalTimer(){const e=document.getElementById("min-counter"),t=document.getElementById("sec-counter"),n=document.getElementById("min-counterv2"),o=document.getElementById("sec-counterv2"),r=document.getElementById("min-counterv3"),a=document.getElementById("sec-counterv3");r&&(r.style.fontWeight="bold"),a&&(a.style.fontWeight="bold");const i=Date.now();function c(){const c=18e5-(Date.now()-i);if(c<=0)return void location.reload(!0);const d=String(Math.floor(c/1e3/60)).padStart(2,"0"),l=String(Math.floor(c/1e3)%60).padStart(2,"0");e&&(e.textContent=d),t&&(t.textContent=l),n&&(n.textContent=d),o&&(o.textContent=l),r&&(r.textContent=d),a&&(a.textContent=l),c<=2e3&&localStorage.setItem("refreshTabs",Date.now())}localStorage.setItem("bullionTimerStart",i),window.addEventListener("storage",e=>{"refreshTabs"===e.key&&location.reload(!0)}),c(),setInterval(c,1e3)}styleTimePicker.textContent="\n  #time-picker-jewe { color:#2b2b2b !important; }\n  #time-picker-jewe option { color:#2b2b2b !important; }\n  select#time-picker-jewe,\n  select#time-picker-jewe option,\n  select#time-picker-jewe:focus-visible {\n    color:#2b2b2b !important;\n  }\n",document.head.appendChild(styleTimePicker),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("time-picker"),t=document.getElementById("time-picker-24");if(!e||!t)return void console.error("Dropdown (#time-picker) or hidden field (#time-picker-24) not found.");e.style.color="#2b2b2b",e.innerHTML='<option value="">Select a time</option>';const n=document.createElement("option");n.value=n.textContent="Before Work (TBC)",e.appendChild(n);for(let t=540;t<=1050;t+=30){const n=Math.floor(t/60),o=t%60,r=0===o?"00":o,a=`${n>12?n-12:n}:${r} ${n>=12?"PM":"AM"}`,i=(n.toString().padStart(2,"0"),document.createElement("option"));i.value=i.textContent=a,e.appendChild(i)}const o=document.createElement("option");o.value=o.textContent="After Work (TBC)",e.appendChild(o),e.addEventListener("change",()=>{const n=e.value;if("Before Work (TBC)"===n)t.value="0600";else if("After Work (TBC)"===n)t.value="1800";else{const e=n.match(/(\d+):(\d+) (AM|PM)/);if(e){let[,n,o,r]=e;n=parseInt(n,10),"PM"===r&&12!==n&&(n+=12),"AM"===r&&12===n&&(n=0),t.value=`${n.toString().padStart(2,"0")}${o}`}else t.value=""}console.log(`Selected: ${n} -> 24hr: ${t.value}`)})}),document.addEventListener("DOMContentLoaded",()=>{window.location.pathname.includes("place-order")&&startLocalTimer()}),document.addEventListener("DOMContentLoaded",()=>{const e=e=>document.getElementById(e),t=e("checkbox-order"),n=e("pay-in-person"),o=e("date-picker-order"),r=e("delivery"),a=e("address"),i=e("shipping"),c=e("existing-order"),d=e("total-price"),l=e("shippingfee"),s=e("total-amount"),u=e("total-amount2");function p(){const e=parseFloat(d?.value||d?.textContent)||0,t=parseFloat(l?.value)||0,n=i&&"true"===i.value?e+t:e;[s,u].forEach(e=>{e&&("value"in e&&(e.value=n.toFixed(2)),e.textContent=n.toFixed(2))})}function m(){a?.value.trim()&&o?.value&&r&&!c?.checked&&(r.value="Error_both")}function g(){a?.value.trim()?(i&&(i.value="true"),r&&!c?.checked&&(r.value="Shipping")):(i&&(i.value="false"),r&&!c?.checked&&(r.value="")),m(),p()}function v(){c&&r&&(c.checked?r.value="Existing_order":a?.value.trim()?r.value="Shipping":r.value="",p())}function h(){o?.value&&r&&!c?.checked&&(r.value="Collect"),m(),p()}function f(){t&&n&&(n.value=t.checked?"Selected":"Not-Selected")}a?.addEventListener("blur",g),a?.addEventListener("change",g),o?.addEventListener("blur",h),t?.addEventListener("change",f),c?.addEventListener("change",()=>{v(),m()}),l?.addEventListener("input",p),i?.addEventListener("change",p),c?.checked?v():(a?.value.trim()&&g(),o?.value&&h()),f(),p()});