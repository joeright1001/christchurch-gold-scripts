document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("environment");e?location.hostname.includes("webflow.io")?e.value="STAGING":e.value="PRODUCTION":console.error("Environment input field with ID 'environment' not found.")}),document.addEventListener("DOMContentLoaded",()=>{const e=e=>document.getElementById(e),t=e("checkbox-order"),o=e("pay-in-person"),n=e("date-picker-order"),a=e("time-picker"),r=e("checkbox-collect-live-low-stock"),i=e("post-collect"),l=e("delivery"),s=e("address"),c=e("shipping"),d=e("existing-order"),u=e("total-price"),p=e("shippingfee"),m=e("total-amount"),h=e("total-amount2");function g(){const e=parseFloat(u?.value||u?.textContent)||0,t=parseFloat(p?.value)||0,o="Shipping"===l?.value,n=o?t:0;c&&("value"in c&&(c.value=n.toFixed(2)),c.textContent=n.toFixed(2));const a=o?e+t:e;[m,h].forEach(e=>{e&&("value"in e&&(e.value=a.toFixed(2)),e.textContent=a.toFixed(2))})}function v(){s?.value.trim()&&n?.value&&l&&!d?.checked&&(l.value="Error_both")}function y(){s?.value.trim()?(c&&(c.value="true"),l&&!d?.checked&&(l.value="Shipping")):(c&&(c.value="false"),l&&!d?.checked&&(l.value="")),v(),g()}function f(){d&&l&&(d.checked?l.value="Existing_order":s?.value.trim()?l.value="Shipping":l.value="",g())}function b(){n?.value&&l&&!d?.checked&&(l.value="Collect"),v(),g()}function P(){a?.value&&l&&!d?.checked&&(l.value="Collect"),v(),g()}function N(){r?.checked&&l&&!d?.checked&&(l.value="Collect"),g()}function k(){i?.value.trim()&&l&&!d?.checked&&(l.value="Shipping"),g()}function w(){t&&o&&(o.value=t.checked?"Selected":"Not-Selected")}s?.addEventListener("blur",y),s?.addEventListener("change",y),n?.addEventListener("blur",b),a?.addEventListener("change",P),r?.addEventListener("change",N),i?.addEventListener("change",k),t?.addEventListener("change",w),d?.addEventListener("change",()=>{f(),v()}),p?.addEventListener("input",g),c?.addEventListener("change",g),d?.checked?f():(s?.value.trim()&&y(),n?.value&&b(),a?.value&&P(),r?.checked&&N(),i?.value.trim()&&k()),w(),g()}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("post-collect"),t=document.getElementById("address");if(!e)return void console.error("Post-collect input element not found");if(!t)return void console.error("Address input element not found");const o=document.createElement("select");o.id="form_field_deliveryLocation",o.className="form-select location-dropdown";const n={"*My PostShop is not on this list":["I will be in contact with my NZ PostShop details"],Ashburton:["Ashburton Countdown"],Auckland:["Albany Box Lobby","Botany Box Lobby","Drury NZ Post Shop","NZ Post Beachlands","NZ Post Depot Waiheke","NZ Post Hardinge Street","NZ Post Highland Park","NZ Post Lynfield","NZ Post Meadowbank","NZ Post Newmarket","NZ Post North Harbour","NZ Post Otara","NZ Post Pakuranga","NZ Post Papatoetoe","NZ Post Takapuna"],Blenheim:["Blenheim Parcel Collection"],Cambridge:["Woolworths Cambridge"],Christchurch:["Aranui NZ Post Centre","Bishopdale Central NZ Post Shop","Cashel Street NZ Post Shop","Christchurch Cashel Box Lobby","Linwood NZ Post Centre","NZ Post Avonhead","NZ Post Bishopdale","NZ Post Cashel Street","NZ Post Phillipstown","NZ Post Rangiora","NZ Post Woolston","Parklands NZ Post Shop"],Dannevirke:["NZ Post Dannevirke"],Darfield:["NZ Post Darfield"],Dargaville:["Dargaville NZ Post Shop"],Drury:["NZ Post Drury"],Dunedin:["Dunedin NZ Post Centre Mornington","NZ Post Green Island","Woolworths Dunedin Central","Woolworths Dunedin South"],Feilding:["NZ Post Feilding"],Gisborne:["Woolworths Gisborne"],Hamilton:["NZ Post Glenview Centre","NZ Post Hamilton","NZ Post Hillcrest","Woolworths Chartwell Mall"],Hastings:["NZ Post Flaxmere","NZ Post Havelock North"],Hawera:["NZ Post Hawera"],Invercargill:["Invercargill North NZ Post Shop","NZ Post South Invercargill","NZ Post Waikiwi - Invercargill"],Katikati:["NZ Post Katikati - Paper Plus Katikati"],Kawerau:["NZ Post Kawerau"],Kerikeri:["Kerikeri NZ Post Shop"],Lincoln:["NZ Post Lincoln"],Masterton:["Woolworths Masterton"],Motueka:["NZ Post Motueka"],Napier:["NZ Post Marewa"],Nelson:["NZ Post Richmond - Paper Plus"],"New Plymouth":["New Plymouth NZ Post Centre","New Plymouth NZ Post Centre Vogeltown","New Plymouth NZ Post Shop Westown"],Ngatea:["NZ Post Ngatea"],Oamaru:["NZ Post North End"],Ohakune:["NZ Post Ohakune"],Opotiki:["Opotiki NZ Post Shop"],Otaki:["NZ Post Otaki"],Paeroa:["NZ Post Paeroa"],"Palmerston North":["Palmerston North NZ Post Centre Awapuni","Palmerston North NZ Post Centre Summerhill"],Queenstown:["NZ Post Private Boxes Queenstown","NZ Post Wakatipu"],Rotorua:["NZ Post Rotorua Amohau Street","Rotorua NZ Post Shop Ngongotaha"],Takaka:["NZ Post Takaka"],Taupo:["Taupo NZ Post Operations Centre"],Tauranga:["NZ Post Bethlehem","NZ Post Cherrywood","Tauranga NZ Post"],"Te Anau":["NZ Post Te Anau"],Timaru:["NZ Post Highfield","NZ Post Timaru"],Tuakau:["NZ Post Tuakau"],Turangi:["Turangi NZ Post Shop Turangi"],"Upper Hutt":["NZ Post Trentham","NZ Post Upper Hutt"],Waimate:["NZ Post Waimate"],Waitara:["NZ Post Waitara"],Waiuku:["NZ Post Waiuku"],Wellington:["NZ Post Island Bay","NZ Post Johnsonville","NZ Post Tawa","Wellington Box Lobby","Wellington NZ Post Centre Hataitai"],Wellsford:["NZ Post Wellsford"],Whakatane:["Whakatane NZ Post Shop Opotiki"],Whangamata:["NZ Post Whangamata"],Whanganui:["Whanganui CourierPost Depot"],Whangaparaoa:["NZ Post Whangaparaoa"],Whangarei:["New Zealand Post Whangarei Depot","NZ Post Te Mai West"],Winton:["NZ Post Winton"]},a=document.createElement("option");a.textContent="-- Please Select --",a.value="",o.appendChild(a);for(const[e,t]of Object.entries(n)){const n=document.createElement("optgroup");n.label=e,t.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}),o.appendChild(n)}o.addEventListener("change",function(){const o=this.value;e.value=o,t.value=o,e.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))}),e.parentNode.insertBefore(o,e),e.style.display="none";const r=document.createElement("style");r.textContent="\n        .location-dropdown {\n            width: 100%;\n            padding: 12px 16px;\n            font-size: 16px;\n            color: #6b7280;\n            background-color: #ffffff;\n            border: 1px solid #d1d5db;\n            border-radius: 8px;\n            outline: none;\n            transition: all 0.2s ease;\n            cursor: pointer;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n            -webkit-appearance: none;\n            -moz-appearance: none;\n            appearance: none;\n            background-image: url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\");\n            background-repeat: no-repeat;\n            background-position: right 12px center;\n            background-size: 20px;\n            padding-right: 40px;\n        }\n        \n        .location-dropdown:hover {\n            border-color: #9ca3af;\n            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);\n        }\n        \n        .location-dropdown:focus {\n            border-color: #3b82f6;\n            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n            color: #111827;\n        }\n        \n        .location-dropdown option {\n            padding: 8px 12px;\n            color: #374151;\n        }\n        \n        .location-dropdown optgroup {\n            font-weight: 600;\n            color: #111827;\n            padding-top: 8px;\n        }\n        \n        .location-dropdown option:hover {\n            background-color: #f3f4f6;\n        }\n        \n        /* Selected value color */\n        .location-dropdown:not(:invalid) {\n            color: #111827;\n        }\n    ",document.head.appendChild(r)}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("close-order-details-icon");e&&e.addEventListener("click",function(e){e.preventDefault();const t=document.getElementById("product-summary-table");if(t){const e=t.getBoundingClientRect().top+window.pageYOffset,o=window.pageYOffset,n=e-o,a=700;let r=null;requestAnimationFrame(function e(t){null===r&&(r=t);const i=t-r,l=(s=i,c=o,d=n,(s/=a/2)<1?d/2*s*s+c:(s--,-d/2*(s*(s-2)-1)+c));var s,c,d;window.scrollTo(0,l),i<a&&requestAnimationFrame(e)})}})});const DEV_URL="https://mware3-staging.up.railway.app",STAGING_FALLBACK_URL="https://mware3-staging.up.railway.app",PROD_URL="https://mware3-production.up.railway.app";async function isCodespaceAvailable(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),1e3),o=(await fetch(DEV_URL+"/health",{signal:e.signal})).ok;return clearTimeout(t),o}catch{return!1}}async function getApiBaseUrl(){return location.hostname.includes("webflow.io")?await isCodespaceAvailable()?DEV_URL:STAGING_FALLBACK_URL:PROD_URL}function setSessionDataWithExpiry(e,t,o){sessionStorage.setItem(e,JSON.stringify({value:t,expiry:Date.now()+6e4*o}))}function getSessionDataWithExpiry(e){const t=JSON.parse(sessionStorage.getItem(e)||"null");return!t||Date.now()>t.expiry?(sessionStorage.removeItem(e),null):t.value}document.addEventListener("DOMContentLoaded",async()=>{!function(){const e={name:document.getElementById("breadcrumb-text")?.textContent||"",url:document.getElementById("breadcrumb-url")?.href||"",metal:document.getElementById("metal")?.textContent||""};setSessionDataWithExpiry("product_url",JSON.stringify(e),30)}();const e=await getApiBaseUrl();console.log("Using API base URL:",e);const t=document.querySelector("#place-order-submit"),o=document.querySelector("#wf-form-bullion-order");function n(e){let t=!0;const n={"first-name":"First name is required","last-name":"Last name is required",email:"Email is required",mobile:"Phone number is required"};if(Object.keys(n).forEach(e=>{const t=o.querySelector(`[name="${e}"]`);var n;t&&(n=t,n.parentElement.querySelector(".error-message")?.remove(),n.style.borderColor="")}),Object.entries(n).forEach(([n,a])=>{const r=o.querySelector(`[name="${n}"]`);e.get(n)?.trim()||(!function(e,t){const o=e.parentElement.querySelector(".error-message");o&&o.remove();const n=document.createElement("div");n.className="error-message",n.textContent=t,n.style.color="red",n.style.fontSize="12px",n.style.marginTop="10px",e.parentElement.appendChild(n),e.style.borderColor="red"}(r,a),t=!1)}),!e.get("product-name-full")){const e=document.getElementById("no-product-selected");e&&(e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"center"})),t=!1}return t}t&&o?t.addEventListener("click",async a=>{a.preventDefault();const r=new FormData(o);if(!n(r))return;let i=document.querySelector("#shippingfee")?.value.trim()||"",l=document.querySelector("#shipping")?.value.trim()||"0";"Shipping"!==r.get("delivery")&&(i="0",l="0");const s={first_name_order:r.get("first-name"),last_name_order:r.get("last-name")||"",email_order:r.get("email"),phone_order:r.get("mobile")||"",product_name_full:r.get("product-name-full")||"",quantity:r.get("quantity")||"",price_nzd:r.get("price_nzd")||"",zoho_id:r.get("zoho-id")||"",collect:r.get("collect")||"",delivery:r.get("delivery")||"",pay_in_person:r.get("pay-in-person")||"",checkbox_order:r.get("checkbox-order")||"",address:r.get("address")||"",message:r.get("message")||"",date_picker_order:r.get("date-picker")||"",time_picker_order:r.get("time-picker")||"",total_price:r.get("total-price")||"",total_amount:r.get("total-amount")||"",shippingfee:i,shipping:l,unit_gst:r.get("unit-gst")||"",total_gst:r.get("total-gst")||"",unit_price_nzd:r.get("unit-price-nzd")||"",total_unit_price_nzd:r.get("total-unit-price-nzd")||"",environment:r.get("environment")||"",supplier_status:r.get("market-status")||"",supplier_name:r.get("market")||"",sku:r.get("sku")||"",auto_supplier:r.get("auto-supplier")||"",supplier_item_id:r.get("supplier-item-id")||""},c=function(e){const t=e.innerHTML;return e.innerHTML='Processing<span class="spinner"></span>',e.classList.add("button-processing"),e.disabled=!0,t}(t);try{const t=await fetch(`${e}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await t.json();if(!n.token||!n.trade_order)throw new Error("Invalid response from server");setSessionDataWithExpiry("orderData",JSON.stringify(s),30),setSessionDataWithExpiry("token",n.token,30),setSessionDataWithExpiry("trade_order",n.trade_order,30),setSessionDataWithExpiry("order_creation_time",n.order_creation_time,30),document.getElementById("trade-order")?.setAttribute("value",n.trade_order),document.getElementById("trade-order-display")?.setAttribute("value",n.trade_order),(document.getElementById("submit-order")||o).click()}catch(e){console.error("Error:",e),u=c,(d=t).innerHTML=u,d.classList.remove("button-processing"),d.disabled=!1,t.textContent="Server-Error";const o=document.getElementById("server-error");o&&(o.style.display="block",o.scrollIntoView({behavior:"smooth",block:"center"}))}var d,u}):console.error("Required elements not found")}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("submit-order"),t=document.getElementById("product-name-full"),o=document.getElementById("no-product-selected");e&&t&&o&&e.addEventListener("click",function(e){t.value.trim()||(e.preventDefault(),o.style.display="block",o.scrollIntoView({behavior:"smooth",block:"center"}))})}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("stock-status"),t=document.getElementById("in-stock-collection-block"),o=document.getElementById("live-low-stock-collection-block");function n(){if(!e||!t||!o)return;"in-stock"===(e.textContent?.trim()||e.value?.trim()||"")?(t.style.display="block",o.style.display="none"):(t.style.display="none",o.style.display="block")}e&&t&&o&&(t.style.display="block",o.style.display="none",function n(a,r=10){e?.textContent?.trim()||e?.value?.trim()?a():r>0?setTimeout(()=>n(a,r-1),200):t&&o&&(t.style.display="none",o.style.display="block")}(n),"input"===e.tagName.toLowerCase()&&(e.addEventListener("input",n),e.addEventListener("change",n)))});const style=document.createElement("style");style.textContent="\n  #time-picker-jewe {\n    color: #2b2b2b !important;\n  }\n  #time-picker-jewe option {\n    color: #2b2b2b !important;\n  }\n  /* For some browsers that need extra styling */\n  select#time-picker-jewe, \n  select#time-picker-jewe option,\n  select#time-picker-jewe:focus-visible {\n    color: #2b2b2b !important;\n  }\n",document.head.appendChild(style),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("time-picker"),t=document.getElementById("time-picker-24");if(!e||!t)return void console.error("Dropdown (#time-picker-jewe) or input field (#time-jewe-24hr) not found.");e.style.color="#2b2b2b",e.innerHTML='<option value="">Select a time</option>';let o=document.createElement("option");o.value="Before Work (TBC)",o.textContent="Before Work (TBC)",o.style.color="#2b2b2b",e.appendChild(o);for(let t=540;t<=1050;t+=30){let o=Math.floor(t/60),n=t%60,a=0===n?"00":n,r=`${o>12?o-12:o}:${a} ${o>=12?"PM":"AM"}`,i=(o.toString().padStart(2,"0"),document.createElement("option"));i.value=r,i.textContent=r,i.style.color="#2b2b2b",e.appendChild(i)}let n=document.createElement("option");n.value="After Work (TBC)",n.textContent="After Work (TBC)",n.style.color="#2b2b2b",e.appendChild(n),e.addEventListener("change",function(){let o=e.value;if("Before Work (TBC)"===o)t.value="0600";else if("After Work (TBC)"===o)t.value="1800";else{let e=o.match(/(\d+):(\d+) (AM|PM)/);if(e){let o=parseInt(e[1],10),n=e[2],a=e[3];"PM"===a&&12!==o&&(o+=12),"AM"===a&&12===o&&(o=0),t.value=`${o.toString().padStart(2,"0")}${n}`}else t.value=""}console.log(`Selected Time: ${o} | Converted: ${t.value}`)})}),document.addEventListener("DOMContentLoaded",()=>{const e=window.location.pathname.split("/").filter(e=>e),t=e[e.length-1];if(t&&"place-order"!==t){document.querySelectorAll(".w-dyn-item").forEach(e=>{e.style.display="none"});const e=document.getElementById(t);if(e){const t=e.closest(".w-dyn-item");t&&(t.style.display="block")}}function o(e,t){t&&["","2"].forEach(o=>{const n=document.getElementById(e+o);n&&("value"in n&&(n.value=t),n.textContent=t)})}const n=new URLSearchParams(window.location.search),a=e=>n.get(e)||"";["quantity","unit-price-nzd","unit-total-price-nzd","unit-gst","unit-total-gst","gst-total","sub-total","total-price","price_nzd","price-signed","product-name-full"].forEach(e=>{o(e,a(e))}),o("gst-total",a("gst-total")),o("total-amount",a("total-price")),window.location.search&&window.history.replaceState({},"",window.location.pathname)});